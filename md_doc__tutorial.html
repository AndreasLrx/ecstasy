<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ECSTASY: Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ECSTASY
   </div>
   <div id="projectbrief">All in the name</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_doc__tutorial.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>The tutorials on this page will help you to use ecstasy, not to understands the concepts and terms. I strongly advise you to look at the <a class="el" href="_glossary_8md.html">glossary</a> before following any tutorials (except the getting started).</dd></dl>
<h1><a class="anchor" id="GettingStarted"></a>
Getting Started</h1>
<p>Here is a basic example of how to use the ECS. The usual order when using ecstasy is the following:</p>
<ul>
<li>Define the components and systems (here Position, Velocity and Movement)</li>
<li>Create the <a class="el" href="classecstasy_1_1_registry.html">Registry</a></li>
<li>Register the <a class="el" href="classecstasy_1_1_i_system.html">Systems</a></li>
<li>Populate the register with <a class="el" href="classecstasy_1_1_entity.html">Entities</a></li>
<li>Run the registry systems with <a class="el" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a></li>
</ul>
<p>In this example we create 10 entities. Every entities have a position component and only even entities have a velocity component. The Movement system will iterate on every entities having a position <b>and</b> a velocity component and add the velocity vector to the position. (Know this is not a perfect approach because the velocity should depend on the elapsed time) Finally we run the systems over and over.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_registry_8hpp.html">ecstasy/registry/Registry.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_i_system_8hpp.html">ecstasy/system/ISystem.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Position {</div>
<div class="line">    <span class="keywordtype">float</span> x;</div>
<div class="line">    <span class="keywordtype">float</span> y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Velocity {</div>
<div class="line">    <span class="keywordtype">float</span> x;</div>
<div class="line">    <span class="keywordtype">float</span> y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Movement : <span class="keyword">public</span> <a class="code" href="classecstasy_1_1_i_system.html">ecstasy::ISystem</a> {</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="classecstasy_1_1_i_system.html#aa9cf50e42a827f26e5d7e2c5d7fe9c46">run</a>(<a class="code" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry) <span class="keyword">override</span> <span class="keyword">final</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.query&lt;Position, <span class="keyword">const</span> Velocity&gt;()) {</div>
<div class="line">            position.x += velocity.x;</div>
<div class="line">            position.y += velocity.y;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="01__basic__window_2main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>() {</div>
<div class="line">    <span class="comment">// Declare your registry</span></div>
<div class="line">    <a class="code" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Register your systems</span></div>
<div class="line">    registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;Movement&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Populate the registry with some entities</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 10; i++) {</div>
<div class="line">        <span class="keyword">auto</span> builder = registry.<a class="code" href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">entityBuilder</a>().<a class="code" href="classecstasy_1_1_registry_1_1_entity_builder.html#a9a9b131844a18902f64eaf941bf693fa">with</a>&lt;Position&gt;(i * 2, i * 10);</div>
<div class="line">        <span class="keywordflow">if</span> (i % 2 == 0)</div>
<div class="line">            builder.<a class="code" href="classecstasy_1_1_registry_1_1_entity_builder.html#a9a9b131844a18902f64eaf941bf693fa">with</a>&lt;Velocity&gt;(i * 10, i * 2);</div>
<div class="line">        <a class="code" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> entity = builder.build();</div>
<div class="line">        <span class="comment">// If needed, use the entity</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        registry.<a class="code" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="a01__basic__window_2main_8cpp_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="01__basic__window_2main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> <a href="01__basic__window_2main_8cpp_source.html#l00022">main.cpp:22</a></div></div>
<div class="ttc" id="a_i_system_8hpp_html"><div class="ttname"><a href="_i_system_8hpp.html">ISystem.hpp</a></div></div>
<div class="ttc" id="a_registry_8hpp_html"><div class="ttname"><a href="_registry_8hpp.html">Registry.hpp</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entity_html"><div class="ttname"><a href="classecstasy_1_1_entity.html">ecstasy::Entity</a></div><div class="ttdoc">Encapsulate an index to an entity.</div><div class="ttdef"><b>Definition:</b> <a href="_entity_8hpp_source.html#l00035">Entity.hpp:35</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_i_system_html"><div class="ttname"><a href="classecstasy_1_1_i_system.html">ecstasy::ISystem</a></div><div class="ttdoc">System interface, base class of all systems.</div><div class="ttdef"><b>Definition:</b> <a href="_i_system_8hpp_source.html#l00026">ISystem.hpp:26</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_i_system_html_aa9cf50e42a827f26e5d7e2c5d7fe9c46"><div class="ttname"><a href="classecstasy_1_1_i_system.html#aa9cf50e42a827f26e5d7e2c5d7fe9c46">ecstasy::ISystem::run</a></div><div class="ttdeci">virtual void run(Registry &amp;registry)=0</div><div class="ttdoc">Run the system.</div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_1_1_entity_builder_html_a9a9b131844a18902f64eaf941bf693fa"><div class="ttname"><a href="classecstasy_1_1_registry_1_1_entity_builder.html#a9a9b131844a18902f64eaf941bf693fa">ecstasy::Registry::EntityBuilder::with</a></div><div class="ttdeci">EntityBuilder &amp; with(Args &amp;&amp;...args)</div><div class="ttdoc">Add a component to the builder target entity.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8hpp_source.html#l00501">Registry.hpp:501</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html"><div class="ttname"><a href="classecstasy_1_1_registry.html">ecstasy::Registry</a></div><div class="ttdoc">Base of an ECS architecture.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8hpp_source.html#l00068">Registry.hpp:68</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a47b4f8718083b99319ff342011e9b110"><div class="ttname"><a href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">ecstasy::Registry::entityBuilder</a></div><div class="ttdeci">EntityBuilder entityBuilder()</div><div class="ttdoc">Create a new entity builder.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8cpp_source.html#l00033">Registry.cpp:33</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a5595f1c0811c0d7f658c01f49da8dc37"><div class="ttname"><a href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">ecstasy::Registry::runSystems</a></div><div class="ttdeci">void runSystems()</div><div class="ttdoc">Run all systems present in the registry.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8cpp_source.html#l00085">Registry.cpp:85</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a84e0f98f2b37e6aa17fd320d443127f0"><div class="ttname"><a href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">ecstasy::Registry::addSystem</a></div><div class="ttdeci">S &amp; addSystem(Args &amp;&amp;...args)</div><div class="ttdoc">Add a new system in the registry.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8hpp_source.html#l00821">Registry.hpp:821</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md24"></a>
Using entities</h1>
<h2><a class="anchor" id="autotoc_md25"></a>
Creating entities</h2>
<p>There is 3 ways to create new entities in the registry:</p>
<ul>
<li>Using the <a class="el" href="classecstasy_1_1_registry.html">registry</a> <a class="el" href="classecstasy_1_1_registry_1_1_entity_builder.html">builder</a></li>
<li>Using the <a class="el" href="classecstasy_1_1_entities.html">entities</a> <a class="el" href="classecstasy_1_1_entities_1_1_builder.html">builder</a></li>
<li>Using the <a class="el" href="classecstasy_1_1_entities.html">entities</a> <a class="el" href="classecstasy_1_1_entities.html#af64aafed2e3a93054537b93b92e5f86a">create()</a> method</li>
</ul>
<p>The builders allows to create entities with components easily whereas the create() method is for internal purposes. They have the same syntax except one difference: the registry builder takes components as template parameters, and fetch the associated storages whereas the entities builder takes storages directly.</p>
<p>The builders have two methods:</p>
<ul>
<li>with(): Adds a new component to the entities (supports constructor parameter or explicit <a class="elRef" href="http://en.cppreference.com/w/cpp/utility/initializer_list.html">std::initializer_list</a>)</li>
<li>build(): Finalize the entity creation</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The with() method returns the builder, allowing to chain the calls.</dd>
<dd>
Since the <a class="el" href="classecstasy_1_1_entities_1_1_builder.html">entities builder</a> <a class="el" href="classecstasy_1_1_entities_1_1_builder.html#ad8159f774ac76318a5dd422f7d46fec0">with()</a> method takes the storage in parameters, it can deduce the storage/component type. You don't have to use the template parameters.</dd></dl>
<p>Here is an example using the two builders:</p>
<div class="fragment"><div class="line"><a class="code" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"><a class="code" href="classecstasy_1_1_entities.html">ecstasy::Entities</a> &amp;entities = registry.<a class="code" href="classecstasy_1_1_registry.html#a8bb4d756e09315c730fc230e6a5bd53a">getEntities</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Registry builder</span></div>
<div class="line"><a class="code" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e1 = registry.<a class="code" href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">entityBuilder</a>().<a class="code" href="classecstasy_1_1_registry_1_1_entity_builder.html#a9a9b131844a18902f64eaf941bf693fa">with</a>&lt;Position&gt;(2, 10)</div>
<div class="line">                        .with&lt;Velocity&gt;(10, 2)</div>
<div class="line">                        .<a class="code" href="classecstasy_1_1_registry_1_1_entity_builder.html#ad6baf09aa8fb77d6c470295f02859aaf">build</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Entities builder</span></div>
<div class="line"><a class="code" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e2 = entities.<a class="code" href="classecstasy_1_1_entities.html#a46b127b2cd6eeeae08d6b513d4742fe1">builder</a>().<a class="code" href="classecstasy_1_1_entities_1_1_builder.html#ad8159f774ac76318a5dd422f7d46fec0">with</a>(registry.<a class="code" href="classecstasy_1_1_registry.html#ad6b0a8d29a43168653502dfc426bacc8">getStorage</a>&lt;Position&gt;(), 2, 10)</div>
<div class="line">                        .with(registry.<a class="code" href="classecstasy_1_1_registry.html#ad6b0a8d29a43168653502dfc426bacc8">getStorage</a>&lt;Velocity&gt;(), 10, 2)</div>
<div class="line">                        .build();</div>
<div class="ttc" id="aclassecstasy_1_1_entities_1_1_builder_html_ad8159f774ac76318a5dd422f7d46fec0"><div class="ttname"><a href="classecstasy_1_1_entities_1_1_builder.html#ad8159f774ac76318a5dd422f7d46fec0">ecstasy::Entities::Builder::with</a></div><div class="ttdeci">Builder &amp; with(S &amp;storage, Args &amp;&amp;...args)</div><div class="ttdoc">Add a component to the builder target entity.</div><div class="ttdef"><b>Definition:</b> <a href="_entities_8hpp_source.html#l00068">Entities.hpp:68</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entities_html"><div class="ttname"><a href="classecstasy_1_1_entities.html">ecstasy::Entities</a></div><div class="ttdoc">Resource holding all the Registry entities.</div><div class="ttdef"><b>Definition:</b> <a href="_entities_8hpp_source.html#l00030">Entities.hpp:30</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entities_html_a46b127b2cd6eeeae08d6b513d4742fe1"><div class="ttname"><a href="classecstasy_1_1_entities.html#a46b127b2cd6eeeae08d6b513d4742fe1">ecstasy::Entities::builder</a></div><div class="ttdeci">Builder builder()</div><div class="ttdoc">Create a new entity builder.</div><div class="ttdef"><b>Definition:</b> <a href="_entities_8cpp_source.html#l00064">Entities.cpp:64</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_1_1_entity_builder_html_ad6baf09aa8fb77d6c470295f02859aaf"><div class="ttname"><a href="classecstasy_1_1_registry_1_1_entity_builder.html#ad6baf09aa8fb77d6c470295f02859aaf">ecstasy::Registry::EntityBuilder::build</a></div><div class="ttdeci">Entity build()</div><div class="ttdoc">Finalize the entity, making it alive.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8cpp_source.html#l00022">Registry.cpp:22</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a8bb4d756e09315c730fc230e6a5bd53a"><div class="ttname"><a href="classecstasy_1_1_registry.html#a8bb4d756e09315c730fc230e6a5bd53a">ecstasy::Registry::getEntities</a></div><div class="ttdeci">const Entities &amp; getEntities() const</div><div class="ttdoc">Get the Entities resource.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8cpp_source.html#l00038">Registry.cpp:38</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_ad6b0a8d29a43168653502dfc426bacc8"><div class="ttname"><a href="classecstasy_1_1_registry.html#ad6b0a8d29a43168653502dfc426bacc8">ecstasy::Registry::getStorage</a></div><div class="ttdeci">const getStorageType&lt; C &gt; &amp; getStorage() const</div><div class="ttdoc">Get the Storage for the component type C.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8hpp_source.html#l00930">Registry.hpp:930</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md26"></a>
Manage entity component</h2>
<p>When you have an instance of an <a class="el" href="classecstasy_1_1_entity.html">Entity</a> you can check the presence of a component, get it or add one. Always by sending the component storage. However, you can also use the <a class="el" href="classecstasy_1_1_registry_entity.html">RegistryEntity</a> class which, as its name says, is linked to a registry. It is only syntactic sugar to avoid fetching yourself storages from the registry.</p>
<p>Examples:</p>
<div class="fragment"><div class="line"><a class="code" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"><span class="comment">// Populate the registry...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Entity class</span></div>
<div class="line"><a class="code" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> entity = registry.<a class="code" href="classecstasy_1_1_registry.html#a5d982d00370574aec1946df44d3484d0">getEntity</a>(0); <span class="comment">// Get your entity</span></div>
<div class="line"><span class="keyword">auto</span> &amp;positionStorage = registry.<a class="code" href="classecstasy_1_1_registry.html#ad6b0a8d29a43168653502dfc426bacc8">getStorage</a>&lt;Position&gt;();</div>
<div class="line">entity.<a class="code" href="classecstasy_1_1_entity.html#a5a5862e6df35e748daff901104c43085">has</a>(storage); <span class="comment">// check if the entity has the component Position</span></div>
<div class="line">entity.<a class="code" href="classecstasy_1_1_entity.html#a12d437d525fdb8d0a49c3c551f0cefa7">add</a>(storage, 5, 12) <span class="comment">// add a new component Position(5, 12)</span></div>
<div class="line"><span class="keyword">auto</span> &amp;pos = entity[storage]; <span class="comment">// Get the position component</span></div>
<div class="line">pos = entity.<a class="code" href="classecstasy_1_1_entity.html#a3c585a555592ec8e5e6854db0f843210">get</a>(storage); <span class="comment">// Same as above</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// RegistryEntity class</span></div>
<div class="line"><a class="code" href="classecstasy_1_1_registry_entity.html">ecstasy::RegistryEntity</a> entity = <a class="code" href="classecstasy_1_1_registry_entity.html">ecstasy::RegistryEntity</a>(entity, registry); <span class="comment">// Link your entity to the registry</span></div>
<div class="line">entity.<a class="code" href="classecstasy_1_1_registry_entity.html#ab8309218f27a95840495e9615cdde286">has</a>&lt;Position&gt;(); <span class="comment">// check if the entity has the component Position</span></div>
<div class="line">entity.<a class="code" href="classecstasy_1_1_registry_entity.html#a3b59d87f10db806ba1e8cbcb76a21b91">add</a>&lt;Position&gt;(5, 12) <span class="comment">// add a new component Position(5, 12)</span></div>
<div class="line">pos = entity.<a class="code" href="classecstasy_1_1_registry_entity.html#a0ee87cdda5590c399ffc4a412db89b40">get</a>&lt;Position&gt;(); <span class="comment">// Same as above</span></div>
<div class="ttc" id="aclassecstasy_1_1_entity_html_a12d437d525fdb8d0a49c3c551f0cefa7"><div class="ttname"><a href="classecstasy_1_1_entity.html#a12d437d525fdb8d0a49c3c551f0cefa7">ecstasy::Entity::add</a></div><div class="ttdeci">S::Component &amp; add(S &amp;storage, Args &amp;&amp;...args)</div><div class="ttdoc">Add a component to the entity.</div><div class="ttdef"><b>Definition:</b> <a href="_entity_8hpp_source.html#l00111">Entity.hpp:111</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entity_html_a3c585a555592ec8e5e6854db0f843210"><div class="ttname"><a href="classecstasy_1_1_entity.html#a3c585a555592ec8e5e6854db0f843210">ecstasy::Entity::get</a></div><div class="ttdeci">const S::Component &amp; get(S &amp;storage) const</div><div class="ttdoc">Try to fetch the instance of component C associated to the current entity.</div><div class="ttdef"><b>Definition:</b> <a href="_entity_8hpp_source.html#l00178">Entity.hpp:178</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entity_html_a5a5862e6df35e748daff901104c43085"><div class="ttname"><a href="classecstasy_1_1_entity.html#a5a5862e6df35e748daff901104c43085">ecstasy::Entity::has</a></div><div class="ttdeci">bool has(S &amp;storage) const</div><div class="ttdoc">Test if the entity has an associated component in the storage S.</div><div class="ttdef"><b>Definition:</b> <a href="_entity_8hpp_source.html#l00216">Entity.hpp:216</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_entity_html"><div class="ttname"><a href="classecstasy_1_1_registry_entity.html">ecstasy::RegistryEntity</a></div><div class="ttdoc">Entity containing a reference to the registry.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_entity_8hpp_source.html#l00026">RegistryEntity.hpp:26</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_entity_html_a0ee87cdda5590c399ffc4a412db89b40"><div class="ttname"><a href="classecstasy_1_1_registry_entity.html#a0ee87cdda5590c399ffc4a412db89b40">ecstasy::RegistryEntity::get</a></div><div class="ttdeci">const C &amp; get() const</div><div class="ttdoc">Try to fetch the instance of component C associated to the current entity.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_entity_8hpp_source.html#l00074">RegistryEntity.hpp:74</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_entity_html_a3b59d87f10db806ba1e8cbcb76a21b91"><div class="ttname"><a href="classecstasy_1_1_registry_entity.html#a3b59d87f10db806ba1e8cbcb76a21b91">ecstasy::RegistryEntity::add</a></div><div class="ttdeci">C &amp; add(Args &amp;&amp;...args)</div><div class="ttdoc">Add a component to the entity.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_entity_8hpp_source.html#l00055">RegistryEntity.hpp:55</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_entity_html_ab8309218f27a95840495e9615cdde286"><div class="ttname"><a href="classecstasy_1_1_registry_entity.html#ab8309218f27a95840495e9615cdde286">ecstasy::RegistryEntity::has</a></div><div class="ttdeci">bool has() const</div><div class="ttdoc">Test if the entity has an associated component in the storage S.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_entity_8hpp_source.html#l00109">RegistryEntity.hpp:109</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a5d982d00370574aec1946df44d3484d0"><div class="ttname"><a href="classecstasy_1_1_registry.html#a5d982d00370574aec1946df44d3484d0">ecstasy::Registry::getEntity</a></div><div class="ttdeci">Entity getEntity(Entity::Index index) noexcept</div><div class="ttdoc">Get the Entity at the index index.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8cpp_source.html#l00048">Registry.cpp:48</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
Delete entities</h2>
<p>First I need to define two words used in the entities context</p>
<ul>
<li>kill: mark an entity for deletion without deleting it, until a call to <a class="el" href="classecstasy_1_1_entities.html#ae6313ea1ae99037aaf335034d66e5e45">Entities.maintain()</a></li>
<li>erase: delete the entity instantly, and its components if any (and accessible)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>You should never erase entities when iterating on them. Kill them instead.</dd></dl>
<p>If you don't want to wory about killing inside the loop and calling the maintain after you can use the simple <a class="el" href="classecstasy_1_1_deletion_stack.html">DeletionStack</a> helper. You can push entities to delete in it and they will be erased when the deletion stack is destroyed.</p>
<p>Examples:</p>
<div class="fragment"><div class="line"><a class="code" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"><span class="keyword">auto</span> &amp;entities = registry.<a class="code" href="classecstasy_1_1_registry.html#a8bb4d756e09315c730fc230e6a5bd53a">getEntities</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Using kill/maintain</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [entity] : registry.<a class="code" href="classecstasy_1_1_registry.html#a2e6b89a6cfc37b53e96cd66103a0a53b">query</a>&lt;<a class="code" href="classecstasy_1_1_entities.html">ecstasy::Entities</a>&gt;()) {</div>
<div class="line">    entities.<a class="code" href="classecstasy_1_1_entities.html#a5b5ee10b59fdbd21568254ad57903755">kill</a>(entity);</div>
<div class="line">}</div>
<div class="line">entities.<a class="code" href="classecstasy_1_1_entities.html#ae6313ea1ae99037aaf335034d66e5e45">maintain</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Deletion stack</span></div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classecstasy_1_1_deletion_stack.html">ecstasy::DeletionStack</a> delStack(registry);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> [entity] : registry.<a class="code" href="classecstasy_1_1_registry.html#a2e6b89a6cfc37b53e96cd66103a0a53b">query</a>&lt;<a class="code" href="classecstasy_1_1_entities.html">ecstasy::Entities</a>&gt;()) {</div>
<div class="line">        delStack.push(entity);</div>
<div class="line">    }</div>
<div class="line">} <span class="comment">// delStack is out of scope -&gt; destroyed, and entities are erased</span></div>
<div class="ttc" id="aclassecstasy_1_1_deletion_stack_html"><div class="ttname"><a href="classecstasy_1_1_deletion_stack.html">ecstasy::DeletionStack</a></div><div class="ttdoc">Helper to manage entity deletion safely within an iteration.</div><div class="ttdef"><b>Definition:</b> <a href="_deletion_stack_8hpp_source.html#l00030">DeletionStack.hpp:30</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entities_html_a5b5ee10b59fdbd21568254ad57903755"><div class="ttname"><a href="classecstasy_1_1_entities.html#a5b5ee10b59fdbd21568254ad57903755">ecstasy::Entities::kill</a></div><div class="ttdeci">bool kill(Entity entity)</div><div class="ttdoc">Mark en entity for deletion.</div><div class="ttdef"><b>Definition:</b> <a href="_entities_8cpp_source.html#l00095">Entities.cpp:95</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entities_html_ae6313ea1ae99037aaf335034d66e5e45"><div class="ttname"><a href="classecstasy_1_1_entities.html#ae6313ea1ae99037aaf335034d66e5e45">ecstasy::Entities::maintain</a></div><div class="ttdeci">std::vector&lt; Entity &gt; maintain()</div><div class="ttdoc">Effectively erase the entities marked for deletion (using kill()).</div><div class="ttdef"><b>Definition:</b> <a href="_entities_8cpp_source.html#l00117">Entities.cpp:117</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a2e6b89a6cfc37b53e96cd66103a0a53b"><div class="ttname"><a href="classecstasy_1_1_registry.html#a2e6b89a6cfc37b53e96cd66103a0a53b">ecstasy::Registry::query</a></div><div class="ttdeci">query::Query&lt; queryable_type_t&lt; C &gt;, queryable_type_t&lt; Cs &gt;... &gt; query(OptionalModifiersAllocator&lt; A &gt; allocator)</div><div class="ttdoc">Construct a query for the given components.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8hpp_source.html#l01028">Registry.hpp:1028</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="CustomStorageTutorial"></a>
Implement a custom storage</h1>
<p>You can specify which storage you want a component to use with the define <a class="el" href="_storage_concepts_8hpp.html#a5081c2ba8fc64b28d27cdf3d74ffa960">SET_COMPONENT_STORAGE</a>. By default the <a class="el" href="classecstasy_1_1_map_storage.html">ecstasy::MapStorage</a> is used for all components but you may implement a more suitable storage based on your component.</p>
<p>To create a custom storage, you need to validate the <a class="el" href="namespaceecstasy.html#a73201157de93701763bb9dda9f0201a7">ecstasy::IsStorage</a> concept. In addition you also need to implement the contains and emplace methods (see MapStorage).</p>
<h1><a class="anchor" id="QueryTutorial"></a>
Making registry queries</h1>
<p>When you populated your registry with entities and resources you can query them with the... <a class="el" href="classecstasy_1_1_registry.html#a2e6b89a6cfc37b53e96cd66103a0a53b">ecstasy::Registry::query</a> method. It will iterate on every entities having the requested components and return a reference of them.</p>
<p>The easiest syntax is to use tuple unpacking in a for loop:</p>
<dl class="section note"><dt>Note</dt><dd>You should get used to querying your types as const if you don't modify them because of <a href="#EnsuringThreadSafety">thread safety</a></dd></dl>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.<a class="code" href="classecstasy_1_1_registry.html#a2e6b89a6cfc37b53e96cd66103a0a53b">query</a>&lt;Position, <span class="keyword">const</span> Velocity&gt;()) {</div>
<div class="line">    position.x += velocity.x;</div>
<div class="line">    position.y += velocity.y;</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can also parallelized your query in multiple threads using the splitThreads query method:</p>
<div class="fragment"><div class="line"><span class="comment">// Will make one thread for every 50 matching entities</span></div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a2e6b89a6cfc37b53e96cd66103a0a53b">query</a>&lt;Position, <span class="keyword">const</span> Velocity&gt;().splitThreads(50, [](<span class="keyword">auto</span> components) {</div>
<div class="line">    <span class="keyword">auto</span> [position, velocity] = components;</div>
<div class="line">    position.x += velocity.x;</div>
<div class="line">    position.y += velocity.y;</div>
<div class="line">});</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Batch queriess (multi threaded) are not always better than single threaded queries. The more complex the task is for each entity, the more you may improve performances with batch queries.</dd></dl>
<p>You can request as many component as you want in the template parameters of the query method.</p>
<p>If you need more complex queries, check the following parts.</p>
<h2><a class="anchor" id="SelectWhereTutorial"></a>
Select ... Where ...</h2>
<p>Sometimes you need to check whether an entity has a given component but you don't need to access it. Let's say you have a <code>Dynamic</code> component required to move your entities but it is only a marker, it stores no data.</p>
<p>You can use the Select ... Where ... syntax:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.<a class="code" href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">select</a>&lt;Position, <span class="keyword">const</span> Velocity&gt;().where&lt;<span class="keyword">const</span> Dynamic&gt;()) {</div>
<div class="line">    position.x += velocity.x;</div>
<div class="line">    position.y += velocity.y;</div>
<div class="line">}</div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a21903809a52f0b813c940182bc102d02"><div class="ttname"><a href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">ecstasy::Registry::select</a></div><div class="ttdeci">Select&lt; queryable_type_t&lt; C &gt;, queryable_type_t&lt; Cs &gt;... &gt; select()</div><div class="ttdoc">Starts the creation of a complex query in the registry.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8hpp_source.html#l01085">Registry.hpp:1085</a></div></div>
</div><!-- fragment --><p>This syntax retrieve only the components in the <code>Select</code> clause but it ensures all components in the <code>Select</code> <b>and</b> <code>Where</code> clauses are present.</p>
<dl class="section note"><dt>Note</dt><dd>You can have the same component in the select and the where clauses. By default all components in Select not present in Where clause are implicitly appended to the where clause.</dd></dl>
<h2><a class="anchor" id="ModifiersTutorial"></a>
Using modifiers</h2>
<p>Even more complex queries, not sure everything here will be usefull but anyway it is implemented ! By default, all components in the query are joined together with a <b>and</b> operator: component A <b>and</b> component B <b>and</b> component C must be present. To modify this behavior you can use <code>modifiers</code>, at the moment the modifiers implemented are mostly boolean operators.</p>
<dl class="section note"><dt>Note</dt><dd>Modifiers can be nested and used in simple queries as well as in Select ... Where ...</dd></dl>
<ol type="1">
<li><p class="startli"><a class="el" href="structecstasy_1_1_maybe.html">ecstasy::Maybe</a></p>
<p class="startli">The first and important modifier is the <a class="el" href="structecstasy_1_1_maybe.html">ecstasy::Maybe</a> operator. It match on any entity and instead of returning a reference to the component it will returns a <a class="elRef" href="http://en.cppreference.com/w/cpp/utility/optional.html">std::optional</a> containing (or not) the component. Here comes an example:</p>
</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity, mDensity] : registry.<a class="code" href="classecstasy_1_1_registry.html#a2e6b89a6cfc37b53e96cd66103a0a53b">query</a>&lt;Position, <span class="keyword">const</span> Velocity, Maybe&lt;const Density&gt;&gt;()) {</div>
<div class="line">    <span class="keywordtype">float</span> multiplier = 1;</div>
<div class="line">    <span class="comment">// Density is a std::optional&lt;std::reference_wrappper&lt;const Density&amp;&gt;&gt;</span></div>
<div class="line">    <span class="keywordflow">if</span> (mDensity)</div>
<div class="line">        multiplier = mDensity-&gt;value;</div>
<div class="line">    position.x += velocity.x * multiplier;</div>
<div class="line">    position.y += velocity.y * multiplier;</div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li><p class="startli"><a class="el" href="structecstasy_1_1_not.html">ecstasy::Not</a></p>
<p class="startli">This one is kinda explicit. We will use a reverse example of the previous <code>Dynamic</code> marker component:</p>
<dl class="section warning"><dt>Warning</dt><dd>Don't use in <code>Select</code> clause because it doesn't make sense to select non existing data.</dd></dl>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.<a class="code" href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">select</a>&lt;Position, <span class="keyword">const</span> Velocity&gt;().where&lt;Not&lt;const Static&gt;&gt;()) {</div>
<div class="line">    position.x += velocity.x;</div>
<div class="line">    position.y += velocity.y;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="structecstasy_1_1_or.html">ecstasy::Or</a> / <a class="el" href="structecstasy_1_1_xor.html">ecstasy::Xor</a></p>
<p class="startli">Performs a <code>Or</code>/<code>XOr</code> between the given components. Returned values are of type <a class="elRef" href="http://en.cppreference.com/w/cpp/utility/tuple.html">std::tuple</a>&lt;std::optional&lt;Q1&gt;, std::optional&lt;Q2&gt;...&gt;. It works for at least two components but can take more than 2. I really don't know real use case of this but well that was fun to code. For an easier access on the tuple you could leave the Or in the where clause and add Maybe selects in the Select:</p>
</li>
</ol>
<div class="fragment"><div class="line"><span class="comment">// Assuming positions is a std::vector&lt;Position&gt;</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, positions, velocity] : registry.<a class="code" href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">select</a>&lt;Maybe&lt;Position&gt;, Maybe&lt;Positions&gt;, <span class="keyword">const</span> Velocity&gt;().where&lt;Or&lt;Position, Positions&gt;&gt;()) {</div>
<div class="line">    <span class="keywordflow">if</span> (position) {</div>
<div class="line">        position.x += velocity.x;</div>
<div class="line">        position.y += velocity.y;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> pos in positions.value()) {</div>
<div class="line">            pos.x += velocity.x;</div>
<div class="line">            pos.y += velocity.y;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li><p class="startli"><a class="el" href="structecstasy_1_1_and.html">ecstasy::And</a></p>
<p class="startli">Same as Or but performs an And. Meaning the returned values are not optional. It looks useless alone because it is the default behavior. But If you are creative you can do something fun with nested modifier... or just ignore that functionnality until you need it (if this times comes)</p>
</li>
</ol>
<div class="fragment"><div class="line"><span class="comment">// Assuming working with 2D or 3D (yes this is dumb you should do 2 systems)</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position2, position3, velocity2, velocity3] : registry</div>
<div class="line">    .select&lt;Maybe&lt;Position2D&gt;, Maybe&lt;Position3D&gt;, Maybe&lt;const Velocity2D&gt;, Maybe&lt;const Velocity3&gt;&gt;()</div>
<div class="line">    .where&lt;<a class="code" href="namespaceecstasy_1_1query_1_1modifier.html#a38c3a9cb4887db042e8f7c1c1fb2c68d">Or</a>&lt;And&lt;Position2D, const Velocity2D&gt;, And&lt;Position3D, const Velocity3D&gt;&gt;&gt;()) {</div>
<div class="line">    <span class="keywordflow">if</span> (position2) {</div>
<div class="line">        position2.x += velocity2.x;</div>
<div class="line">        position2.y += velocity2.y;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        position3.x += velocity3.x;</div>
<div class="line">        position3.y += velocity3.y;</div>
<div class="line">        position3.z += velocity3.z;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceecstasy_1_1query_1_1modifier_html_a38c3a9cb4887db042e8f7c1c1fb2c68d"><div class="ttname"><a href="namespaceecstasy_1_1query_1_1modifier.html#a38c3a9cb4887db042e8f7c1c1fb2c68d">ecstasy::query::modifier::Or</a></div><div class="ttdeci">constexpr auto Or(Q1 &amp;firstOperand, Q2 &amp;secondOperand, Qs &amp;...otherOperands)</div><div class="ttdef"><b>Definition:</b> <a href="query_2modifiers_2_or_8hpp_source.html#l00144">Or.hpp:144</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="ConditionsTutorial"></a>
Using conditions</h2>
<p>In addition to the different modifiers, you can add runtime conditions to your query. Basic comparisons are implemented but you can add custom ones.</p>
<p>Conditions supports comparisons with:</p>
<ul>
<li>Constant values: <code>0</code></li>
<li>Class member: <code>&amp;Life::value</code></li>
<li>Class getter: <code>&amp;Life::getValue</code></li>
</ul>
<ol type="1">
<li><p class="startli"><a class="el" href="namespaceecstasy.html#a3636e577cd1e59a7d31089601561cc39">ecstasy::EqualTo</a></p>
<p class="startli">Ensure the two operands are equal for each matching entities.</p>
</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.<a class="code" href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">select</a>&lt;<span class="keyword">const</span> Life&gt;().where&lt;<a class="code" href="structecstasy_1_1query_1_1_condition.html">ecstasy::EqualTo&lt;&amp;Life::value, 0&gt;</a>&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value == 0)) continue;</span></div>
<div class="line">}</div>
<div class="ttc" id="astructecstasy_1_1query_1_1_condition_html"><div class="ttname"><a href="structecstasy_1_1query_1_1_condition.html">ecstasy::query::Condition</a></div><div class="ttdef"><b>Definition:</b> <a href="conditions_2_condition_8hpp_source.html#l00022">Condition.hpp:22</a></div></div>
</div><!-- fragment --><ol type="1">
<li><p class="startli"><a class="el" href="namespaceecstasy.html#a632aba6a51f51ed40b7bdc35331c6821">ecstasy::NotEqualTo</a></p>
<p class="startli">Ensure the two operands are not equal for each matching entities.</p>
</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.<a class="code" href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">select</a>&lt;<span class="keyword">const</span> Life&gt;().where&lt;<a class="code" href="structecstasy_1_1query_1_1_condition.html">ecstasy::NotEqualTo&lt;&amp;Life::value, 0&gt;</a>&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value != 0)) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li><p class="startli"><a class="el" href="namespaceecstasy.html#a8a47386bd7276dc4040566079eb1ec04">ecstasy::Less</a></p>
<p class="startli">Ensure the first operand is strictly lower than the second operand.</p>
</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.<a class="code" href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">select</a>&lt;<span class="keyword">const</span> Life&gt;().where&lt;Shield, <a class="code" href="structecstasy_1_1query_1_1_condition.html">ecstasy::Less&lt;&amp;Life::value, &amp;Shield::getValue&gt;</a>&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value &lt; shield.getValue())) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li><p class="startli"><a class="el" href="namespaceecstasy.html#ac8221c0f73ca2e3e2d5d7e92c5241317">ecstasy::LessEqual</a></p>
<p class="startli">Ensure the first operand is lower than or equal to the second operand.</p>
</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.<a class="code" href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">select</a>&lt;<span class="keyword">const</span> Life&gt;().where&lt;Shield, <a class="code" href="structecstasy_1_1query_1_1_condition.html">ecstasy::LessEqual&lt;&amp;Life::value, &amp;Shield::getValue&gt;</a>&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value &lt;= shield.getValue())) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li><p class="startli"><a class="el" href="namespaceecstasy.html#a261413d053df4c424df13459db564c8b">ecstasy::Greater</a></p>
<p class="startli">Ensure the first operand is strictly greater than the second operand.</p>
</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.<a class="code" href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">select</a>&lt;<span class="keyword">const</span> Life&gt;().where&lt;Shield, <a class="code" href="structecstasy_1_1query_1_1_condition.html">ecstasy::Greater&lt;&amp;Life::value, &amp;Shield::getValue&gt;</a>&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value &gt; shield.getValue())) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li><p class="startli"><a class="el" href="namespaceecstasy.html#accbc147ca8de440fdbe11ea1f67148af">ecstasy::GreaterEqual</a></p>
<p class="startli">Ensure the first operand is greater than or equal to the second operand.</p>
</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.<a class="code" href="classecstasy_1_1_registry.html#a21903809a52f0b813c940182bc102d02">select</a>&lt;<span class="keyword">const</span> Life&gt;().where&lt;Shield, <a class="code" href="structecstasy_1_1query_1_1_condition.html">ecstasy::GreaterEqual&lt;&amp;Life::value, &amp;Shield::getValue&gt;</a>&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value &gt;= shield.getValue())) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28"></a>
Using systems</h1>
<p>To create systems, you only have to create a new class inheriting the <a class="el" href="classecstasy_1_1_i_system.html">ecstasy::ISystem</a> class and implement the <a class="el" href="classecstasy_1_1_i_system.html#aa9cf50e42a827f26e5d7e2c5d7fe9c46">ecstasy::ISystem::run</a> method.</p>
<p>For example here is how you would create a Movement system:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Movement : <span class="keyword">public</span> <a class="code" href="classecstasy_1_1_i_system.html">ecstasy::ISystem</a> {</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="classecstasy_1_1_i_system.html#aa9cf50e42a827f26e5d7e2c5d7fe9c46">run</a>(<a class="code" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry) <span class="keyword">override</span> <span class="keyword">final</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.<a class="code" href="classecstasy_1_1_registry.html#a2e6b89a6cfc37b53e96cd66103a0a53b">query</a>&lt;Position, <span class="keyword">const</span> Velocity&gt;()) {</div>
<div class="line">            position.x += velocity.x;</div>
<div class="line">            position.y += velocity.y;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add it to the registry</span></div>
<div class="line"><a class="code" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"> </div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;Movement&gt;();</div>
<div class="line"> </div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a59904982ed7490f12c63628951178dd5">runSystem</a>&lt;Movement&gt;();</div>
<div class="line"><span class="comment">// or</span></div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>();</div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a59904982ed7490f12c63628951178dd5"><div class="ttname"><a href="classecstasy_1_1_registry.html#a59904982ed7490f12c63628951178dd5">ecstasy::Registry::runSystem</a></div><div class="ttdeci">void runSystem()</div><div class="ttdoc">Run a specific system from the registry.</div><div class="ttdef"><b>Definition:</b> <a href="_registry_8hpp_source.html#l01135">Registry.hpp:1135</a></div></div>
</div><!-- fragment --><p>By default systems added with <code>Registry.addSystem()</code> have the same priority and the order of execution is undefined when calling <code>Registry.runSystems()</code>. But you can use the system priorities/groups to order them and be able to specify their priority and run a given system group.</p>
<ol type="1">
<li><p class="startli">Priority</p>
<p class="startli">When adding a system to the registry you can add a priority to each system as a second template parameter. Calling <code>runSystems()</code> will run the systems in ascending priority order.</p>
<dl class="section warning"><dt>Warning</dt><dd>You can set the same priority for multiple systems but it doesn't ensure they will always run in the same order.</dd></dl>
<div class="fragment"><div class="line"><a class="code" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"> </div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;A, 1&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;B, 2&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;C, 3&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;D, 4&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;E, 5&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;F, 6&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>(); <span class="comment">// ABCDEF</span></div>
<div class="line"><span class="comment">// If you want you can still call systems one by one</span></div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a59904982ed7490f12c63628951178dd5">runSystem</a>&lt;A&gt;(); <span class="comment">// A</span></div>
</div><!-- fragment --></li>
<li><p class="startli">Group and masks</p>
<p class="startli">In fact their is nothing more than the priority value. But using bitmask you can create groups.</p>
<p class="startli">The following example use 8 bits for the group id and 8 for the system priority.</p>
</li>
</ol>
<div class="fragment"><div class="line"><a class="code" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"><span class="comment">// Mask of the group part on the priority (bits 8-&gt;15)</span></div>
<div class="line"><span class="keywordtype">size_t</span> mask = 0xff00;</div>
<div class="line"><span class="comment">// Groups &#39;identifiers&#39;</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> abc = 0x0100;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> def = 0x0200;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Group &#39;abc&#39;</span></div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;A, abc + 1&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;B, abc + 2&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;C, abc + 3&gt;();</div>
<div class="line"><span class="comment">// Group &#39;def&#39;</span></div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;D, def + 1&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;E, def + 2&gt;();</div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a84e0f98f2b37e6aa17fd320d443127f0">addSystem</a>&lt;F, def + 3&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The following still calls the systems in the right order because their priorities are still ascending</span></div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>(); <span class="comment">// ABCDEF</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// You can run a system group by sending the group id and the mask</span></div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>(abc, mask); <span class="comment">// ABC</span></div>
<div class="line">registry.<a class="code" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>(def, mask); <span class="comment">// DEF</span></div>
</div><!-- fragment --><h1><a class="anchor" id="EnsuringThreadSafety"></a>
Ensuring Thread Safety</h1>
<p>By default ecstasy is not thread safe. By not thread safe I mean there is absolutely nothing enabled to prevent your threads to do whatever they want at the same time.</p>
<p>But no worries it is just some compilation options to set:</p>
<ul>
<li><b>ECSTASY_LOCKABLE_RESOURCES</b> will make Resource class validate the <a class="el" href="namespaceecstasy_1_1thread.html#a3228b7205e71792e3a2f64a83579dc37">Lockable</a> concept.</li>
<li><b>ECSTASY_LOCKABLE_STORAGES</b> will make IStorage class validate the <a class="el" href="namespaceecstasy_1_1thread.html#a3228b7205e71792e3a2f64a83579dc37">Lockable</a> concept.</li>
<li><b>ECSTASY_AUTO_LOCK</b> will lock any <a class="el" href="namespaceecstasy_1_1thread.html#a3228b7205e71792e3a2f64a83579dc37">Lockable</a> queryables in any registry queries or registry modifiers.</li>
<li><b>ECSTASY_THREAD_SAFE</b> will enable the three options above.</li>
</ul>
<p>This being done every lockables will be locked (if <b>ECSTASY_AUTO_LOCK</b> is set) when performing queries from the registry:</p>
<ul>
<li>If they are queried const qualified they will be shared lock, meaning multiple threads can access the queryables at the same time in a read only way.</li>
<li>However if they are not const qualified the lock will be exclusive, waiting any thread reading (or writing) the queryable and then blocking any other thread to access it until unlocked.</li>
</ul>
<p>This allows a generic thread safety while reducing thread contention as much as possible.</p>
<p>If you want to handle thread safety yourself you still have multiple options:</p>
<ol type="1">
<li><p class="startli">Get it your own way</p>
<p class="startli">Just disable the above options and do what you want, but outside the queries because of encapsulation you will not have the same generic access.</p>
</li>
<li><p class="startli">Lock explicitly</p>
<p class="startli">Keep the resources/storages as lockable and use the Registry::queryEx (and Select.whereEx) methods or AndEx, OrEx, NotEx modifiers where you can explicitly specify the AutoLock value.</p>
</li>
<li><p class="startli">AutoLock by default but disable when you know what you're doing</p>
<p class="startli">I know sometimes ecstasy can lock multiple times the same mutex because it is hard to detect. But if you know it and it is sensitive systems (running lot of times per frame) you can use the *Ex methods to UnLock explicitly the same way. </p>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
