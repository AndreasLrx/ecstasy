<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ECSTASY: User Actions integration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ECSTASY
   </div>
   <div id="projectbrief">All in the name</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_2integrations_2user__actions.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">User Actions integration</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md57">Description</a></li>
<li class="level1"><a href="#autotoc_md58">Usage</a><ul><li class="level2"><a href="#autotoc_md59">Register your actions and bindings</a></li>
<li class="level2"><a href="#autotoc_md60">Listen to your actions</a><ul><li class="level3"><a href="#autotoc_md61">ActionListener</a></li>
<li class="level3"><a href="#autotoc_md62">ActionListeners</a></li>
<li class="level3"><a href="#autotoc_md63">ActionIdListener</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md64">Using intermediate actions</a></li>
<li class="level2"><a href="#autotoc_md65">Saving and loading the bindings</a><ul><li class="level3"><a href="#autotoc_md66">Saving</a></li>
<li class="level3"><a href="#autotoc_md67">Loading</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="autotoc_md56"></a></p>
<h1><a class="anchor" id="autotoc_md57"></a>
Description</h1>
<p>The <a class="el" href="namespaceecstasy_1_1integration_1_1user__action.html">user actions integration</a> allows to map events to an action. Actions can be mapped to keyboard, mouse or gamepad, making the handle of different inputs easier since you don't have to deal with the different event types between keyboard/gamepad. It also helps dealing with local multiplayer as an action can be linked to a specific user. Finally it has included toml serialization functions to save/load the user keybinds.</p>
<p>If you don't really understand what is an Action here is an example: You play a 2D plateformer game where you can <em>move left</em>, <em>move right</em> and <em>jump</em>, these are your 3 actions. If you have local multiplayer you will need these actions for <b>each player</b>, that's why "user actions", action binding are attached to a specific player.</p>
<dl class="section warning"><dt>Warning</dt><dd>This integration requires the event integration</dd></dl>
<h1><a class="anchor" id="autotoc_md58"></a>
Usage</h1>
<p>We'll see how to implement listeners for the example of a 2D platformer. Move actions will be configured with arrows and ZQSD on keyboard, and left axis and left/right triggers on gamepad.</p>
<h2><a class="anchor" id="autotoc_md59"></a>
Register your actions and bindings</h2>
<p>An action is simply and identifier. An action binding is a link between an action identifier, a user identifier and an event (multiple bindings can be linked to the same action/user id).</p>
<p>The easier to define your action identifiers is simply to use an enum.</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> Actions : <span class="keywordtype">size_t</span> { MoveLeft, MoveRight, MoveHorizontal, Jump, Count };</div>
</div><!-- fragment --><p>Now to create the bindings follow these steps:</p>
<ul>
<li>Add a Users resource to the registry</li>
<li>Add your Action bindings to your users</li>
<li>Notify the user resources bindings have changed</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">using </span>eua = <a class="code hl_namespace" href="namespaceecstasy_1_1integration_1_1user__action.html">ecstasy::integration::user_action</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceecstasy_1_1integration_1_1event.html">event</a> = <a class="code hl_namespace" href="namespaceecstasy_1_1integration_1_1event.html">ecstasy::integration::event</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setupActions(<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// We need this resource to store the action bindings and handle the various users profiles</span></div>
<div class="line">   eua::Users &amp;users = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a79cab84435e7b20e9c41aae9cc543cfa">addResource</a>&lt;eua::Users&gt;();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Get a reference to the bindings vector of the first user (getUserProfile has a parameter to set the user ID, default to 0)</span></div>
<div class="line">   <span class="comment">// I admit this is a little verbose</span></div>
<div class="line">   <span class="keyword">auto</span> &amp;binds = users.getUserProfile().getActionBindings().getBindings();</div>
<div class="line">   <span class="comment">// Run backwards !</span></div>
<div class="line">   binds.emplace_back(Actions::MoveLeft, event::Keyboard::Key::Q);</div>
<div class="line">   binds.emplace_back(Actions::MoveLeft, event::Keyboard::Key::Left);</div>
<div class="line">   binds.emplace_back(Actions::MoveLeft, event::Gamepad::Axis::TriggerLeft);</div>
<div class="line">   <span class="comment">// Run forward !</span></div>
<div class="line">   binds.emplace_back(Actions::MoveRight, event::Keyboard::Key::D);</div>
<div class="line">   binds.emplace_back(Actions::MoveRight, event::Keyboard::Key::Right);</div>
<div class="line">   binds.emplace_back(Actions::MoveRight, event::Gamepad::Axis::TriggerRight);</div>
<div class="line">   <span class="comment">// RUN, need a specific action because gamepad axis are from range -1 to 1</span></div>
<div class="line">   binds.emplace_back(Actions::MoveHorizontal, event::Gamepad::Axis::LeftX);</div>
<div class="line">   <span class="comment">// Jump !</span></div>
<div class="line">   binds.emplace_back(Actions::Jump, event::Keyboard::Key::Space);</div>
<div class="line">   binds.emplace_back(Actions::Jump, event::Gamepad::Button::FaceDown);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// This is important to notice the users the internal bindings vector has changed</span></div>
<div class="line">   users.updateBindings();</div>
<div class="line">}</div>
<div class="ttc" id="aclassecstasy_1_1_registry_html"><div class="ttname"><a href="classecstasy_1_1_registry.html">ecstasy::Registry</a></div><div class="ttdoc">Base of an ECS architecture.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00068">Registry.hpp:68</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a79cab84435e7b20e9c41aae9cc543cfa"><div class="ttname"><a href="classecstasy_1_1_registry.html#a79cab84435e7b20e9c41aae9cc543cfa">ecstasy::Registry::addResource</a></div><div class="ttdeci">R &amp; addResource(Args &amp;&amp;...args)</div><div class="ttdoc">Add a new resource in the registry.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00812">Registry.hpp:812</a></div></div>
<div class="ttc" id="anamespaceecstasy_1_1integration_1_1event_html"><div class="ttname"><a href="namespaceecstasy_1_1integration_1_1event.html">ecstasy::integration::event</a></div><div class="ttdoc">Event integration.</div><div class="ttdef"><b>Definition</b> <a href="_event_8hpp_source.html#l00024">Event.hpp:25</a></div></div>
<div class="ttc" id="anamespaceecstasy_1_1integration_1_1user__action_html"><div class="ttname"><a href="namespaceecstasy_1_1integration_1_1user__action.html">ecstasy::integration::user_action</a></div><div class="ttdoc">User action integration.</div><div class="ttdef"><b>Definition</b> <a href="_action_8hpp_source.html#l00017">Action.hpp:18</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md60"></a>
Listen to your actions</h2>
<p>There are 3 component types to have action listeners:</p>
<ul>
<li><a class="el" href="structecstasy_1_1integration_1_1user__action_1_1_action_listener.html">ActionListener</a>: Single action listener, easy to create but limited to a single function since entity can't have multiple instances of the same component.</li>
<li><a class="el" href="namespaceecstasy_1_1integration_1_1user__action.html#a463f381fdabb7e1e0b9b5ca3a2173fa1">ActionListeners</a>: Map between Action id &lt;-&gt; Action Listener, verbose to instantiate but allows to listen to every action type in different callbacks</li>
<li><a class="el" href="structecstasy_1_1integration_1_1user__action_1_1_action_id_listener.html">ActionIdListener</a>: Templated listener to take advantage of the ecs query system, requires another resource/system to works</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>They can be used together, either on different entities or on the same entity.</dd>
<dd>
Listeners can be targeted toward an action type (identifier), if you want to match all actions you can use the special identifier <a class="el" href="structecstasy_1_1integration_1_1user__action_1_1_action.html#abfc74bb7c7919963a9658153588e33db">Actions::All</a></dd></dl>
<h3><a class="anchor" id="autotoc_md61"></a>
ActionListener</h3>
<p><a class="el" href="structecstasy_1_1integration_1_1user__action_1_1_action_listener.html">ActionListener</a> are the easiest listeners, but you can attach only one of them to each entities.</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>eua = <a class="code hl_namespace" href="namespaceecstasy_1_1integration_1_1user__action.html">ecstasy::integration::user_action</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setupListeners(<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// This entity will listen to every action change</span></div>
<div class="line">   registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">entityBuilder</a>()</div>
<div class="line">      .<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#a9e0a1c1e4cb39f7d34d8c440f3461e0f">with</a>&lt;eua::ActionListener&gt;([](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">         <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Action &quot;</span>&lt;&lt;a.id&lt;&lt;<span class="stringliteral">&quot; has value &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">         }</div>
<div class="line">      )</div>
<div class="line">      .build();</div>
<div class="line">   <span class="comment">// Or only to jump</span></div>
<div class="line">   registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">entityBuilder</a>()</div>
<div class="line">      .<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#a9e0a1c1e4cb39f7d34d8c440f3461e0f">with</a>&lt;eua::ActionListener&gt;([](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">         <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Jump action (&quot;</span>&lt;&lt;a.id&lt;&lt;<span class="stringliteral">&quot;) has value &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">         },</div>
<div class="line">         Actions::Jump</div>
<div class="line">      )</div>
<div class="line">      .build();</div>
<div class="line">}</div>
<div class="ttc" id="aclassecstasy_1_1_entity_html"><div class="ttname"><a href="classecstasy_1_1_entity.html">ecstasy::Entity</a></div><div class="ttdoc">Encapsulate an index to an entity.</div><div class="ttdef"><b>Definition</b> <a href="_entity_8hpp_source.html#l00035">Entity.hpp:35</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_1_1_entity_builder_html_a9e0a1c1e4cb39f7d34d8c440f3461e0f"><div class="ttname"><a href="classecstasy_1_1_registry_1_1_entity_builder.html#a9e0a1c1e4cb39f7d34d8c440f3461e0f">ecstasy::Registry::EntityBuilder::with</a></div><div class="ttdeci">EntityBuilder &amp; with(Args &amp;&amp;...args)</div><div class="ttdoc">Add a component to the builder target entity.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00505">Registry.hpp:505</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a47b4f8718083b99319ff342011e9b110"><div class="ttname"><a href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">ecstasy::Registry::entityBuilder</a></div><div class="ttdeci">EntityBuilder entityBuilder()</div><div class="ttdoc">Create a new entity builder.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8cpp_source.html#l00033">Registry.cpp:33</a></div></div>
<div class="ttc" id="acout_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a></div></div>
<div class="ttc" id="aendl_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a></div><div class="ttdeci">T endl(T... args)</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md62"></a>
ActionListeners</h3>
<p><a class="el" href="namespaceecstasy_1_1integration_1_1user__action.html#a463f381fdabb7e1e0b9b5ca3a2173fa1">ActionListeners</a> allows to handle all actions independently in a single component, but it is quite verbose to instantiate.</p>
<dl class="section warning"><dt>Warning</dt><dd>Using Action::All does not work with this component</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">using </span>eua = <a class="code hl_namespace" href="namespaceecstasy_1_1integration_1_1user__action.html">ecstasy::integration::user_action</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setupListeners(<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// This entity will listen to every action change, and have also special behaviors for the different actions</span></div>
<div class="line">   <span class="comment">// The internal map has eua::Action::Id as keys (size_t) and enum cannot be converted implicitly so casts are required.</span></div>
<div class="line">   registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">entityBuilder</a>()</div>
<div class="line">      .<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#a9e0a1c1e4cb39f7d34d8c440f3461e0f">with</a>&lt;eua::ActionListeners&gt;({</div>
<div class="line">         {<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(Actions::MoveLeft), [&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">            <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Move to the left at speed &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">            }</div>
<div class="line">         },</div>
<div class="line">         {<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(Actions::MoveRight), [&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">            <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Move to the right at speed &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">            }</div>
<div class="line">         },</div>
<div class="line">         {<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(Actions::Jump), [&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">            <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Jump! &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">            }</div>
<div class="line">         }</div>
<div class="line">      })</div>
<div class="line">      .build();</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md63"></a>
ActionIdListener</h3>
<p><a class="el" href="structecstasy_1_1integration_1_1user__action_1_1_action_id_listener.html">ActionIdListener</a> are templated listeners bound to a specific action. It is mostly the same as basic ActionListener, but since they are templated you can have multiple instances on the same entity.</p>
<p>To make them works you need to add a resource and a system first:</p>
<ul>
<li><a class="el" href="namespaceecstasy_1_1integration_1_1user__action.html#a9b4f873eff13ede42a8a53839aea12b0">PendingActions Resource</a>: A queue to store the detected actions not yet distributed to listeners</li>
<li><a class="el" href="classecstasy_1_1integration_1_1user__action_1_1_poll_actions.html">PollActions System</a>: Poll the actions from the queue and dispatch them to the templated ActionIdListener components</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>You should run the PollActions system after the events have been detected. If you are using the SFML integration it means after the PollEvents system.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">using </span>eua = <a class="code hl_namespace" href="namespaceecstasy_1_1integration_1_1user__action.html">ecstasy::integration::user_action</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setupListeners(<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// Add the actions queue</span></div>
<div class="line">   registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a79cab84435e7b20e9c41aae9cc543cfa">addResource</a>&lt;eua::PendingActions&gt;();</div>
<div class="line">   <span class="comment">// Add the actions polling system</span></div>
<div class="line">   <span class="comment">// It takes as template parameters an integer sequence where each entry is supposed to match an action id, and therefore an ActionIdListener storage</span></div>
<div class="line">   registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;eua::PollActions&lt;std::make_index_sequence&lt;static_cast&lt;size_t&gt;(Actions::Count)&gt;&gt;&gt;();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">   <span class="comment">// This entity will listen to every action change, and have also special behaviors for the different actions</span></div>
<div class="line">   <span class="comment">// The templated type expects eua::Action::Id (size_t) and enum cannot be converted implicitly so casts are required.</span></div>
<div class="line">   registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">entityBuilder</a>()</div>
<div class="line">      .<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#a9e0a1c1e4cb39f7d34d8c440f3461e0f">with</a>&lt;eua::ActionIdListener&lt;static_cast&lt;size_t&gt;(Actions::MoveLeft)&gt;&gt;([&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">         <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Move to the left at speed &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">      })</div>
<div class="line">      .with&lt;eua::ActionIdListener&lt;<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(Actions::MoveRight)&gt;&gt;([&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">         <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Move to the right at speed &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">      })</div>
<div class="line">      .with&lt;eua::ActionIdListener&lt;<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(Actions::Jump)&gt;&gt;([&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">         <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Jump! &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">      })</div>
<div class="line">      .build();</div>
<div class="line">}</div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a9ae0f363babc862fecb95e860730f5b7"><div class="ttname"><a href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">ecstasy::Registry::addSystem</a></div><div class="ttdeci">S &amp; addSystem(Args &amp;&amp;...args)</div><div class="ttdoc">Add a new system in the registry.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00791">Registry.hpp:791</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md64"></a>
Using intermediate actions</h2>
<p>You may have noticed the <code>MoveHorizontal</code> action in the register part but not in the listener. It is because this action is different because it expects an input between -1 and 1, as would be the value produced from a gamepad axis (joystick).</p>
<p>But the buttons/key return either 1 or 0 (pressed or not) so they are not compatible with a gamepad axis. What we can do however to make them compatible is use <code>MoveLeft</code> and <code>MoveRight</code> as intermediate actions, and use <code>MoveHorizontal</code> for your game logic.</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>eua = <a class="code hl_namespace" href="namespaceecstasy_1_1integration_1_1user__action.html">ecstasy::integration::user_action</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setupListeners(<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// We&#39;ll use this entity to convert our actions</span></div>
<div class="line">   registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">entityBuilder</a>()</div>
<div class="line">      .<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#a9e0a1c1e4cb39f7d34d8c440f3461e0f">with</a>&lt;eua::ActionIdListener&lt;static_cast&lt;size_t&gt;(Actions::MoveLeft)&gt;&gt;([&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">         a.id = Actions::MoveHorizontal;</div>
<div class="line">         a.value = -a.value; <span class="comment">// We are in the negative way</span></div>
<div class="line">         <span class="comment">// Send it back to the appropriate listeners</span></div>
<div class="line">         r.<a class="code hl_function" href="classecstasy_1_1_registry.html#a516a8ea8065455d601a30e1d3afbef52">getResource</a>&lt;eua::Users&gt;().callActionListeners(r, a)</div>
<div class="line">      })</div>
<div class="line">      .with&lt;eua::ActionIdListener&lt;<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(Actions::MoveRight)&gt;&gt;([&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">         a.id = Actions::MoveHorizontal;</div>
<div class="line">         <span class="comment">// Send it back to the appropriate listeners</span></div>
<div class="line">         r.<a class="code hl_function" href="classecstasy_1_1_registry.html#a516a8ea8065455d601a30e1d3afbef52">getResource</a>&lt;eua::Users&gt;().callActionListeners(r, a)</div>
<div class="line">      })</div>
<div class="line">      .build();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// And this is our real entity watching the move action</span></div>
<div class="line">   registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a47b4f8718083b99319ff342011e9b110">entityBuilder</a>()</div>
<div class="line">      .<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#a9e0a1c1e4cb39f7d34d8c440f3461e0f">with</a>&lt;eua::ActionIdListener&lt;static_cast&lt;size_t&gt;(Actions::MoveHorizontal)&gt;&gt;([&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">         <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Moving at speed &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">      })</div>
<div class="line">      .with&lt;eua::ActionIdListener&lt;<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(Actions::Jump)&gt;&gt;([&amp;values](<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;r, <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e, eua::Action a) {</div>
<div class="line">         <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;Jump! &quot;</span>&lt;&lt;a.value&lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">      })</div>
<div class="line">      .build();</div>
<div class="line">}</div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a516a8ea8065455d601a30e1d3afbef52"><div class="ttname"><a href="classecstasy_1_1_registry.html#a516a8ea8065455d601a30e1d3afbef52">ecstasy::Registry::getResource</a></div><div class="ttdeci">ResourceReference&lt; const R, Locked &gt; getResource() const</div><div class="ttdoc">Get the Resource of type R.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00864">Registry.hpp:864</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md65"></a>
Saving and loading the bindings</h2>
<p>You can convert <a class="el" href="classecstasy_1_1integration_1_1user__action_1_1_user_profile.html">UserProfile</a> bindings to/from toml format using <code>dump()</code> and <code>load()</code> methods.</p>
<p>Examples are much better so here it is!</p>
<h3><a class="anchor" id="autotoc_md66"></a>
Saving</h3>
<div class="fragment"><div class="line"><span class="keyword">using </span>eua = <a class="code hl_namespace" href="namespaceecstasy_1_1integration_1_1user__action.html">ecstasy::integration::user_action</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> saveProfile(<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry, eua::UserProfile::Id userId = 0)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// Consider we called the setupActions from above</span></div>
<div class="line">   toml::table out = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a516a8ea8065455d601a30e1d3afbef52">getResource</a>&lt;eua::Users&gt;().getUserProfile(userId).dump();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Just replace this with a filestream if you want to save to a file</span></div>
<div class="line">   <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>&lt;&lt; out &lt;&lt;<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The action are registered by their ids until there is an easy way to serialize them. For the moment ecstasy only has size_t values when serializing so it is serialized as it. (Comments with action names are manually added for better comprehension)</dd></dl>
<div class="fragment"><div class="line">id = 0</div>
<div class="line"> </div>
<div class="line">[bindings]</div>
<div class="line"># Move Left</div>
<div class="line">Action-0 = [ &#39;Key-&gt;Q&#39;, &#39;Key-&gt;Left&#39;, &#39;GamePadAxis-&gt;TriggerLeft&#39; ]</div>
<div class="line"># Move Right</div>
<div class="line">Action-1 = [ &#39;Key-&gt;D&#39;, &#39;Key-&gt;Right&#39;, &#39;GamePadAxis-&gt;TriggerRight&#39; ]</div>
<div class="line"># Move Horizontal</div>
<div class="line">Action-2 = [ &#39;GamepadAxis-&gt;LeftX&#39; ]</div>
<div class="line"># Jump</div>
<div class="line">Action-3 = [ &#39;Key-&gt;Space&#39;, &#39;GamepadButton-&gt;FaceDown&#39; ]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md67"></a>
Loading</h3>
<div class="fragment"><div class="line"><span class="keyword">using </span>eua = <a class="code hl_namespace" href="namespaceecstasy_1_1integration_1_1user__action.html">ecstasy::integration::user_action</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loadProfile(<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry, <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/string/basic_string_view.html">std::string_view</a> bindings)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// Consider we called the setupActions from above</span></div>
<div class="line">   toml::table in = toml::parse(bindings);</div>
<div class="line"> </div>
<div class="line">   <span class="keyword">auto</span> &amp;profile = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a516a8ea8065455d601a30e1d3afbef52">getResource</a>&lt;eua::Users&gt;().getUserProfile(<span class="keyword">static_cast&lt;</span>UserProfile::Id<span class="keyword">&gt;</span>(in.get(<span class="stringliteral">&quot;id&quot;</span>)-&gt;as_integer()-&gt;get()));</div>
<div class="line">   profile.load(in);</div>
<div class="line">}</div>
<div class="ttc" id="abasic_string_view_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/string/basic_string_view.html">std::string_view</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
