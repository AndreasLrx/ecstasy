<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ECSTASY: Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ECSTASY
   </div>
   <div id="projectbrief">All in the name</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_2_tutorial.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="tutorial"></a> </p><dl class="section note"><dt>Note</dt><dd>The tutorials on this page will help you to use ecstasy, not to understands the concepts and terms. I strongly advise you to look at the <a href="https://andreaslrx.github.io/ecstasy/md_doc_2_glossary.html">glossary</a> before following any tutorials (except the getting started).</dd></dl>
<h1><a class="anchor" id="GettingStarted"></a>
Getting Started</h1>
<p>Here is a basic example of how to use the ECS. The usual order when using ecstasy is the following:</p>
<ul>
<li>Define the components and systems (here Position, Velocity and Movement)</li>
<li>Create the <a class="el" href="classecstasy_1_1_registry.html">Registry</a></li>
<li>Register the <a class="el" href="classecstasy_1_1_i_system.html">Systems</a></li>
<li>Populate the register with <a class="el" href="classecstasy_1_1_entity.html">Entities</a></li>
<li>Run the registry systems with <a class="el" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a></li>
</ul>
<p>In this example we create 10 entities. Every entities have a position component and only even entities have a velocity component. The Movement system will iterate on every entities having a position <b>and</b> a velocity component and add the velocity vector to the position. (Know this is not a perfect approach because the velocity should depend on the elapsed time).</p>
<p>Finally we run the systems over and over.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_registry_8hpp.html">ecstasy/registry/Registry.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_i_system_8hpp.html">ecstasy/system/ISystem.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_map_storage_8hpp.html">ecstasy/storages/MapStorage.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Position {</div>
<div class="line">    <span class="keywordtype">float</span> x;</div>
<div class="line">    <span class="keywordtype">float</span> y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Velocity {</div>
<div class="line">    <span class="keywordtype">float</span> x;</div>
<div class="line">    <span class="keywordtype">float</span> y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Movement : <span class="keyword">public</span> <a class="code hl_class" href="classecstasy_1_1_i_system.html">ecstasy::ISystem</a> {</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classecstasy_1_1_i_system.html#aa9cf50e42a827f26e5d7e2c5d7fe9c46">run</a>(<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry) <span class="keyword">override</span> <span class="keyword">final</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.query&lt;Position, const Velocity&gt;()) {</div>
<div class="line">            position.x += velocity.x;</div>
<div class="line">            position.y += velocity.y;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="01__basic__window_2main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>() {</div>
<div class="line">    <span class="comment">// Declare your registry</span></div>
<div class="line">    <a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Register your systems</span></div>
<div class="line">    registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;Movement&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Populate the registry with some entities</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 10; i++) {</div>
<div class="line">        <span class="keyword">auto</span> builder = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a4418ff08eb494b1babb2ee715035d20a">entityBuilder</a>();</div>
<div class="line">        builder.<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#ae55a0fc396c88eeedb1795b3fd6cb0f7">with</a>&lt;Position&gt;(i * 2, i * 10);</div>
<div class="line">        <span class="keywordflow">if</span> (i % 2 == 0)</div>
<div class="line">            builder.<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#ae55a0fc396c88eeedb1795b3fd6cb0f7">with</a>&lt;Velocity&gt;(i * 10, i * 2);</div>
<div class="line">        <a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> entity = builder.build();</div>
<div class="line">        <span class="comment">// If needed, use the entity</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="a01__basic__window_2main_8cpp_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="01__basic__window_2main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition</b> <a href="01__basic__window_2main_8cpp_source.html#l00022">main.cpp:22</a></div></div>
<div class="ttc" id="a_i_system_8hpp_html"><div class="ttname"><a href="_i_system_8hpp.html">ISystem.hpp</a></div><div class="ttdoc">System interface, base class of all systems.</div></div>
<div class="ttc" id="a_map_storage_8hpp_html"><div class="ttname"><a href="_map_storage_8hpp.html">MapStorage.hpp</a></div><div class="ttdoc">Associative Map to store entity components.</div></div>
<div class="ttc" id="a_registry_8hpp_html"><div class="ttname"><a href="_registry_8hpp.html">Registry.hpp</a></div><div class="ttdoc">Registry class definition.</div></div>
<div class="ttc" id="aclassecstasy_1_1_entity_html"><div class="ttname"><a href="classecstasy_1_1_entity.html">ecstasy::Entity</a></div><div class="ttdoc">Encapsulate an index to an entity.</div><div class="ttdef"><b>Definition</b> <a href="_entity_8hpp_source.html#l00035">Entity.hpp:35</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_i_system_html"><div class="ttname"><a href="classecstasy_1_1_i_system.html">ecstasy::ISystem</a></div><div class="ttdoc">System interface, base class of all systems.</div><div class="ttdef"><b>Definition</b> <a href="_i_system_8hpp_source.html#l00026">ISystem.hpp:26</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_i_system_html_aa9cf50e42a827f26e5d7e2c5d7fe9c46"><div class="ttname"><a href="classecstasy_1_1_i_system.html#aa9cf50e42a827f26e5d7e2c5d7fe9c46">ecstasy::ISystem::run</a></div><div class="ttdeci">virtual void run(Registry &amp;registry)=0</div><div class="ttdoc">Run the system.</div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_1_1_entity_builder_html_ae55a0fc396c88eeedb1795b3fd6cb0f7"><div class="ttname"><a href="classecstasy_1_1_registry_1_1_entity_builder.html#ae55a0fc396c88eeedb1795b3fd6cb0f7">ecstasy::Registry::EntityBuilder::with</a></div><div class="ttdeci">EntityBuilder &amp; with(Args &amp;&amp;...args)</div><div class="ttdoc">Add a component to the builder target entity.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00564">Registry.hpp:564</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html"><div class="ttname"><a href="classecstasy_1_1_registry.html">ecstasy::Registry</a></div><div class="ttdoc">Base of an ECS architecture.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00080">Registry.hpp:80</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a4418ff08eb494b1babb2ee715035d20a"><div class="ttname"><a href="classecstasy_1_1_registry.html#a4418ff08eb494b1babb2ee715035d20a">ecstasy::Registry::entityBuilder</a></div><div class="ttdeci">EntityBuilder entityBuilder() noexcept</div><div class="ttdoc">Create a new entity builder.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8cpp_source.html#l00033">Registry.cpp:33</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a5595f1c0811c0d7f658c01f49da8dc37"><div class="ttname"><a href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">ecstasy::Registry::runSystems</a></div><div class="ttdeci">void runSystems()</div><div class="ttdoc">Run all systems present in the registry.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8cpp_source.html#l00084">Registry.cpp:84</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a9ae0f363babc862fecb95e860730f5b7"><div class="ttname"><a href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">ecstasy::Registry::addSystem</a></div><div class="ttdeci">S &amp; addSystem(Args &amp;&amp;...args)</div><div class="ttdoc">Add a new system in the registry.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00832">Registry.hpp:832</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="using-entities"></a>
Using entities</h1>
<h2><a class="anchor" id="creating-entities"></a>
Creating entities</h2>
<p>There are 3 ways to create new entities in the registry:</p>
<ul>
<li>Using the <a class="el" href="classecstasy_1_1_registry.html">registry</a> <a class="el" href="classecstasy_1_1_registry_1_1_entity_builder.html">builder</a></li>
<li>Using the <a class="el" href="classecstasy_1_1_entities.html">entities</a> <a class="el" href="classecstasy_1_1_entities_1_1_builder.html">builder</a></li>
<li>Using the <a class="el" href="classecstasy_1_1_entities.html">entities</a> <a class="el" href="classecstasy_1_1_entities.html#af64aafed2e3a93054537b93b92e5f86a">create()</a> method</li>
</ul>
<p>The builders allows to create entities with components easily whereas the create() method is for internal purposes. They have the same syntax except one difference: the registry builder takes components as template parameters, and fetch the associated storages whereas the entities builder takes storages directly.</p>
<p>The builders have two methods:</p>
<ul>
<li>with(): Adds a new component to the entities (supports constructor parameter or explicit <a class="elRef" href="http://en.cppreference.com/w/cpp/utility/initializer_list.html">std::initializer_list</a>)</li>
<li>build(): Finalize the entity creation</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The with() method returns the builder, allowing to chain the calls.</dd>
<dd>
Since the <a class="el" href="classecstasy_1_1_entities_1_1_builder.html">entities builder</a> <a class="el" href="classecstasy_1_1_entities_1_1_builder.html#a6d7863b8f9b0b9a6efc34e78c300709a">with()</a> method takes the storage in parameters, it can deduce the storage/component type. You don't have to use the template parameters.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>You should never try to use persistent pointers/reference to components. A component memory address is unstable and can change due to its storage. For example adding a new element to the storage may make the storage resize and <b>move</b> its components. Therefore you should be very carefull when using <b>this</b> inside a component constructor for example. In case you really need an identifier, use the entity ID.</dd></dl>
<p>Here is an example using the two builders:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_entities.html">ecstasy::Entities</a> &amp;entities = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#aa5e142b869a115fca7f24debea38681b">getEntities</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Registry builder</span></div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e1 = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a4418ff08eb494b1babb2ee715035d20a">entityBuilder</a>().<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#ae55a0fc396c88eeedb1795b3fd6cb0f7">with</a>&lt;Position&gt;(2, 10)</div>
<div class="line">                        .with&lt;Velocity&gt;(10, 2)</div>
<div class="line">                        .<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#ad6baf09aa8fb77d6c470295f02859aaf">build</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Entities builder</span></div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e2 = entities.<a class="code hl_function" href="classecstasy_1_1_entities.html#a46b127b2cd6eeeae08d6b513d4742fe1">builder</a>().<a class="code hl_function" href="classecstasy_1_1_entities_1_1_builder.html#a6d7863b8f9b0b9a6efc34e78c300709a">with</a>(registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9fa7247f6c5383c37be80ee116de1e62">getStorage</a>&lt;Position&gt;(), 2, 10)</div>
<div class="line">                        .with(registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9fa7247f6c5383c37be80ee116de1e62">getStorage</a>&lt;Velocity&gt;(), 10, 2)</div>
<div class="line">                        .build();</div>
<div class="ttc" id="aclassecstasy_1_1_entities_1_1_builder_html_a6d7863b8f9b0b9a6efc34e78c300709a"><div class="ttname"><a href="classecstasy_1_1_entities_1_1_builder.html#a6d7863b8f9b0b9a6efc34e78c300709a">ecstasy::Entities::Builder::with</a></div><div class="ttdeci">Builder &amp; with(S &amp;storage, Args &amp;&amp;...args)</div><div class="ttdoc">Add a component to the builder target entity.</div><div class="ttdef"><b>Definition</b> <a href="_entities_8hpp_source.html#l00068">Entities.hpp:68</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entities_html"><div class="ttname"><a href="classecstasy_1_1_entities.html">ecstasy::Entities</a></div><div class="ttdoc">Resource holding all the Registry entities.</div><div class="ttdef"><b>Definition</b> <a href="_entities_8hpp_source.html#l00030">Entities.hpp:30</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entities_html_a46b127b2cd6eeeae08d6b513d4742fe1"><div class="ttname"><a href="classecstasy_1_1_entities.html#a46b127b2cd6eeeae08d6b513d4742fe1">ecstasy::Entities::builder</a></div><div class="ttdeci">Builder builder()</div><div class="ttdoc">Create a new entity builder.</div><div class="ttdef"><b>Definition</b> <a href="_entities_8cpp_source.html#l00065">Entities.cpp:65</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_1_1_entity_builder_html_ad6baf09aa8fb77d6c470295f02859aaf"><div class="ttname"><a href="classecstasy_1_1_registry_1_1_entity_builder.html#ad6baf09aa8fb77d6c470295f02859aaf">ecstasy::Registry::EntityBuilder::build</a></div><div class="ttdeci">Entity build()</div><div class="ttdoc">Finalize the entity, making it alive.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8cpp_source.html#l00022">Registry.cpp:22</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a9fa7247f6c5383c37be80ee116de1e62"><div class="ttname"><a href="classecstasy_1_1_registry.html#a9fa7247f6c5383c37be80ee116de1e62">ecstasy::Registry::getStorage</a></div><div class="ttdeci">const getStorageType&lt; C &gt; &amp; getStorage() const</div><div class="ttdoc">Get the Storage for the component type C.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00942">Registry.hpp:942</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_aa5e142b869a115fca7f24debea38681b"><div class="ttname"><a href="classecstasy_1_1_registry.html#aa5e142b869a115fca7f24debea38681b">ecstasy::Registry::getEntities</a></div><div class="ttdeci">ResourceReference&lt; const Entities, Locked &gt; getEntities() const</div><div class="ttdoc">Get the Entities resource.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00994">Registry.hpp:994</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="using-type-resolution"></a>
Using type resolution</h3>
<p>You can add Component storages, Resources, Systems, or even the Registry instance to the <code>with</code> template parameters. This will fetch them from the registry and forward them to the component constructor.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>NeedStorage {</div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_class" href="classecstasy_1_1_map_storage.html">ecstasy::MapStorage&lt;Position&gt;</a> &amp;storage;</div>
<div class="line"> </div>
<div class="line">    NeedStorage(<span class="keyword">const</span> <a class="code hl_class" href="classecstasy_1_1_map_storage.html">ecstasy::MapStorage&lt;Position&gt;</a> &amp;aStorage) : storage(aStorage)</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> e1 = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a4418ff08eb494b1babb2ee715035d20a">entityBuilder</a>()</div>
<div class="line">                        .<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#ae55a0fc396c88eeedb1795b3fd6cb0f7">with</a>&lt;NeedStorage, Position&gt;() <span class="comment">// No need to send registry.getStorage&lt;Position&gt;() as parameters</span></div>
<div class="line">                        .build();</div>
<div class="ttc" id="aclassecstasy_1_1_map_storage_html"><div class="ttname"><a href="classecstasy_1_1_map_storage.html">ecstasy::MapStorage</a></div><div class="ttdoc">Associative Map to store entity components Recommended for sparse components.</div><div class="ttdef"><b>Definition</b> <a href="_map_storage_8hpp_source.html#l00031">MapStorage.hpp:31</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="manage-entity-component"></a>
Manage entity component</h2>
<p>When you have an instance of an <a class="el" href="classecstasy_1_1_entity.html">Entity</a> you can check the presence of a component, get it or add one. Always by sending the component storage. However, you can also use the <a class="el" href="classecstasy_1_1_registry_entity.html">RegistryEntity</a> class which, as its name says, is linked to a registry. It is only syntactic sugar to avoid fetching yourself storages from the registry.</p>
<p>Examples:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"><span class="comment">// Populate the registry...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Entity class</span></div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_entity.html">ecstasy::Entity</a> entity = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a273b519ae0177c7350b44d93f6306fdf">getEntity</a>(0); <span class="comment">// Get your entity</span></div>
<div class="line"><span class="keyword">auto</span> &amp;positionStorage = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9fa7247f6c5383c37be80ee116de1e62">getStorage</a>&lt;Position&gt;();</div>
<div class="line">entity.<a class="code hl_function" href="classecstasy_1_1_entity.html#a5a5862e6df35e748daff901104c43085">has</a>(storage); <span class="comment">// check if the entity has the component Position</span></div>
<div class="line">entity.<a class="code hl_function" href="classecstasy_1_1_entity.html#aab273bfe6a547817e1a9259eba5912cd">add</a>(storage, 5, 12) <span class="comment">// add a new component Position(5, 12)</span></div>
<div class="line"><span class="keyword">auto</span> &amp;pos = entity[storage]; <span class="comment">// Get the position component</span></div>
<div class="line">pos = entity.<a class="code hl_function" href="classecstasy_1_1_entity.html#aedd2cea83d94e06702e063c75b0b1ddb">get</a>(storage); <span class="comment">// Same as above</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// RegistryEntity class</span></div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_registry_entity.html">ecstasy::RegistryEntity</a> entity = <a class="code hl_class" href="classecstasy_1_1_registry_entity.html">ecstasy::RegistryEntity</a>(entity, registry); <span class="comment">// Link your entity to the registry</span></div>
<div class="line">entity.<a class="code hl_function" href="classecstasy_1_1_registry_entity.html#ab8309218f27a95840495e9615cdde286">has</a>&lt;Position&gt;(); <span class="comment">// check if the entity has the component Position</span></div>
<div class="line">entity.<a class="code hl_function" href="classecstasy_1_1_registry_entity.html#a66d16e8a12f364fdd94a12d11767f9f8">add</a>&lt;Position&gt;(5, 12) <span class="comment">// add a new component Position(5, 12)</span></div>
<div class="line">pos = entity.<a class="code hl_function" href="classecstasy_1_1_registry_entity.html#a64b5b5609880025e9d195014b847bae0">get</a>&lt;Position&gt;(); <span class="comment">// Same as above</span></div>
<div class="ttc" id="aclassecstasy_1_1_entity_html_a5a5862e6df35e748daff901104c43085"><div class="ttname"><a href="classecstasy_1_1_entity.html#a5a5862e6df35e748daff901104c43085">ecstasy::Entity::has</a></div><div class="ttdeci">bool has(S &amp;storage) const</div><div class="ttdoc">Test if the entity has an associated component in the storage S.</div><div class="ttdef"><b>Definition</b> <a href="_entity_8hpp_source.html#l00216">Entity.hpp:216</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entity_html_aab273bfe6a547817e1a9259eba5912cd"><div class="ttname"><a href="classecstasy_1_1_entity.html#aab273bfe6a547817e1a9259eba5912cd">ecstasy::Entity::add</a></div><div class="ttdeci">S::Component &amp; add(S &amp;storage, Args &amp;&amp;...args)</div><div class="ttdoc">Add a component to the entity.</div><div class="ttdef"><b>Definition</b> <a href="_entity_8hpp_source.html#l00111">Entity.hpp:111</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entity_html_aedd2cea83d94e06702e063c75b0b1ddb"><div class="ttname"><a href="classecstasy_1_1_entity.html#aedd2cea83d94e06702e063c75b0b1ddb">ecstasy::Entity::get</a></div><div class="ttdeci">const S::Component &amp; get(S &amp;storage) const</div><div class="ttdoc">Try to fetch the instance of component C associated to the current entity.</div><div class="ttdef"><b>Definition</b> <a href="_entity_8hpp_source.html#l00178">Entity.hpp:178</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_entity_html"><div class="ttname"><a href="classecstasy_1_1_registry_entity.html">ecstasy::RegistryEntity</a></div><div class="ttdoc">Entity containing a reference to the registry.</div><div class="ttdef"><b>Definition</b> <a href="_registry_entity_8hpp_source.html#l00026">RegistryEntity.hpp:26</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_entity_html_a64b5b5609880025e9d195014b847bae0"><div class="ttname"><a href="classecstasy_1_1_registry_entity.html#a64b5b5609880025e9d195014b847bae0">ecstasy::RegistryEntity::get</a></div><div class="ttdeci">const C &amp; get() const</div><div class="ttdoc">Try to fetch the instance of component C associated to the current entity.</div><div class="ttdef"><b>Definition</b> <a href="_registry_entity_8hpp_source.html#l00074">RegistryEntity.hpp:74</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_entity_html_a66d16e8a12f364fdd94a12d11767f9f8"><div class="ttname"><a href="classecstasy_1_1_registry_entity.html#a66d16e8a12f364fdd94a12d11767f9f8">ecstasy::RegistryEntity::add</a></div><div class="ttdeci">C &amp; add(Args &amp;&amp;...args)</div><div class="ttdoc">Add a component to the entity.</div><div class="ttdef"><b>Definition</b> <a href="_registry_entity_8hpp_source.html#l00055">RegistryEntity.hpp:55</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_entity_html_ab8309218f27a95840495e9615cdde286"><div class="ttname"><a href="classecstasy_1_1_registry_entity.html#ab8309218f27a95840495e9615cdde286">ecstasy::RegistryEntity::has</a></div><div class="ttdeci">bool has() const</div><div class="ttdoc">Test if the entity has an associated component in the storage S.</div><div class="ttdef"><b>Definition</b> <a href="_registry_entity_8hpp_source.html#l00109">RegistryEntity.hpp:109</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a273b519ae0177c7350b44d93f6306fdf"><div class="ttname"><a href="classecstasy_1_1_registry.html#a273b519ae0177c7350b44d93f6306fdf">ecstasy::Registry::getEntity</a></div><div class="ttdeci">Entity getEntity(Entity::Index index)</div><div class="ttdoc">Get the Entity at the index index.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8cpp_source.html#l00038">Registry.cpp:38</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="delete-entities"></a>
Delete entities</h2>
<p>First I need to define two words used in the entities context</p>
<ul>
<li>kill: mark an entity for deletion without deleting it, until a call to <a class="el" href="classecstasy_1_1_entities.html#ae6313ea1ae99037aaf335034d66e5e45">Entities.maintain()</a></li>
<li>erase: delete the entity instantly, and its components if any (and accessible)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>You should never erase entities when iterating on them. Kill them instead.</dd></dl>
<p>If you don't want to wory about killing inside the loop and calling the maintain after you can use the simple <a class="el" href="classecstasy_1_1_deletion_stack.html">DeletionStack</a> helper. You can push entities to delete in it and they will be erased when the deletion stack is destroyed.</p>
<p>Examples:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"><span class="keyword">auto</span> &amp;entities = registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#aa5e142b869a115fca7f24debea38681b">getEntities</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Using kill/maintain</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [entity] : registry.query&lt;<a class="code hl_namespace" href="namespaceecstasy.html">ecstasy</a>::Entities&gt;()) {</div>
<div class="line">    entities.<a class="code hl_function" href="classecstasy_1_1_entities.html#a5b5ee10b59fdbd21568254ad57903755">kill</a>(entity);</div>
<div class="line">}</div>
<div class="line">entities.<a class="code hl_function" href="classecstasy_1_1_entities.html#ae6313ea1ae99037aaf335034d66e5e45">maintain</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Deletion stack</span></div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="classecstasy_1_1_deletion_stack.html">ecstasy::DeletionStack</a> delStack(registry);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> [entity] : registry.query&lt;<a class="code hl_namespace" href="namespaceecstasy.html">ecstasy</a>::Entities&gt;()) {</div>
<div class="line">        delStack.push(entity);</div>
<div class="line">    }</div>
<div class="line">} <span class="comment">// delStack is out of scope -&gt; destroyed, and entities are erased</span></div>
<div class="ttc" id="aclassecstasy_1_1_deletion_stack_html"><div class="ttname"><a href="classecstasy_1_1_deletion_stack.html">ecstasy::DeletionStack</a></div><div class="ttdoc">Helper to manage entity deletion safely within an iteration.</div><div class="ttdef"><b>Definition</b> <a href="_deletion_stack_8hpp_source.html#l00030">DeletionStack.hpp:30</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entities_html_a5b5ee10b59fdbd21568254ad57903755"><div class="ttname"><a href="classecstasy_1_1_entities.html#a5b5ee10b59fdbd21568254ad57903755">ecstasy::Entities::kill</a></div><div class="ttdeci">bool kill(Entity entity)</div><div class="ttdoc">Mark en entity for deletion.</div><div class="ttdef"><b>Definition</b> <a href="_entities_8cpp_source.html#l00096">Entities.cpp:96</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_entities_html_ae6313ea1ae99037aaf335034d66e5e45"><div class="ttname"><a href="classecstasy_1_1_entities.html#ae6313ea1ae99037aaf335034d66e5e45">ecstasy::Entities::maintain</a></div><div class="ttdeci">std::vector&lt; Entity &gt; maintain()</div><div class="ttdoc">Effectively erase the entities marked for deletion (using kill()).</div><div class="ttdef"><b>Definition</b> <a href="_entities_8cpp_source.html#l00118">Entities.cpp:118</a></div></div>
<div class="ttc" id="anamespaceecstasy_html"><div class="ttname"><a href="namespaceecstasy.html">ecstasy</a></div><div class="ttdoc">Namespace containing all symbols specific to ecstasy.</div><div class="ttdef"><b>Definition</b> <a href="ecstasy_8hpp_source.html#l00029">ecstasy.hpp:30</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="CustomStorageTutorial"></a>
Implement a custom storage</h1>
<p>You can specify which storage you want a component to use with the define <a class="el" href="_storage_concepts_8hpp.html#a5081c2ba8fc64b28d27cdf3d74ffa960">SET_COMPONENT_STORAGE</a>. By default the <a class="el" href="classecstasy_1_1_map_storage.html">MapStorage</a> is used for all components but you may implement a more suitable storage based on your component.</p>
<p>To create a custom storage, you need to validate the <a class="el" href="conceptecstasy_1_1_is_storage.html">IsStorage</a> concept. In addition you also need to implement the contains and emplace methods (see MapStorage).</p>
<h1><a class="anchor" id="QueryTutorial"></a>
Making registry queries</h1>
<p>When you populated your registry with entities and resources you can query them with the... <a class="el" href="classecstasy_1_1_registry.html#a827c2ce78375ab3c8cd3027f6c531eb6">query()</a> method. It will iterate on every entities having the requested components and return a reference of them.</p>
<p>The easiest syntax is to use tuple unpacking in a for loop:</p>
<dl class="section note"><dt>Note</dt><dd>You should get used to querying your types as const if you don't modify them because of <a class="el" href="md_doc_2_tutorial.html#EnsuringThreadSafety">thread safety</a></dd></dl>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.query&lt;Position, const Velocity&gt;()) {</div>
<div class="line">    position.x += velocity.x;</div>
<div class="line">    position.y += velocity.y;</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can also parallelized your query in multiple threads using the splitThreads query method:</p>
<div class="fragment"><div class="line"><span class="comment">// Will make one thread for every 50 matching entities</span></div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a827c2ce78375ab3c8cd3027f6c531eb6">query</a>&lt;Position, <span class="keyword">const</span> Velocity&gt;().splitThreads(50, [](<span class="keyword">auto</span> components) {</div>
<div class="line">    <span class="keyword">auto</span> [position, velocity] = components;</div>
<div class="line">    position.x += velocity.x;</div>
<div class="line">    position.y += velocity.y;</div>
<div class="line">});</div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a827c2ce78375ab3c8cd3027f6c531eb6"><div class="ttname"><a href="classecstasy_1_1_registry.html#a827c2ce78375ab3c8cd3027f6c531eb6">ecstasy::Registry::query</a></div><div class="ttdeci">RegistrySelectStackQuery&lt; thread::AUTO_LOCK_DEFAULT, queryable_type_t&lt; C &gt;, queryable_type_t&lt; Cs &gt;... &gt; query()</div><div class="ttdoc">Construct a query for the given components.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l01077">Registry.hpp:1077</a></div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Batch queriess (multi threaded) are not always better than single threaded queries. The more complex the task is for each entity, the more you may improve performances with batch queries.</dd></dl>
<p>You can request as many component as you want in the template parameters of the query method.</p>
<p>If you need more complex queries, check the following parts.</p>
<h2><a class="anchor" id="SelectWhereTutorial"></a>
Select ... Where ...</h2>
<p>Sometimes you need to check whether an entity has a given component but you don't need to access it. Let's say you have a <code>Dynamic</code> component required to move your entities but it is only a marker, it stores no data.</p>
<p>You can use the Select ... Where ... syntax:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.select&lt;Position, const Velocity&gt;().where&lt;const Dynamic&gt;()) {</div>
<div class="line">    position.x += velocity.x;</div>
<div class="line">    position.y += velocity.y;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This syntax retrieve only the components in the <code>Select</code> clause but it ensures all components in the <code>Select</code> <b>and</b> <code>Where</code> clauses are present.</p>
<dl class="section note"><dt>Note</dt><dd>You can have the same component in the select and the where clauses. By default all components in Select not present in Where clause are implicitly appended to the where clause.</dd></dl>
<h2><a class="anchor" id="ModifiersTutorial"></a>
Using modifiers</h2>
<p>Even more complex queries, not sure everything here will be usefull but anyway it is implemented ! By default, all components in the query are joined together with a <b>and</b> operator: component A <b>and</b> component B <b>and</b> component C must be present. To modify this behavior you can use <code>modifiers</code>, at the moment the modifiers implemented are mostly boolean operators.</p>
<dl class="section note"><dt>Note</dt><dd>Modifiers can be nested and used in simple queries as well as in Select ... Where ...</dd></dl>
<ol type="1">
<li><p class="startli"><a class="el" href="structecstasy_1_1_maybe.html">ecstasy::Maybe</a></p>
<p class="startli">The first and important modifier is the <a class="el" href="structecstasy_1_1_maybe.html">Maybe</a> operator. It match on any entity and instead of returning a reference to the component it will returns a <a class="elRef" href="http://en.cppreference.com/w/cpp/utility/optional.html">std::optional</a> containing (or not) the component. Here comes an example:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity, mDensity] : registry.query&lt;Position, const Velocity, Maybe&lt;const Density&gt;&gt;()) {</div>
<div class="line">    <span class="keywordtype">float</span> multiplier = 1;</div>
<div class="line">    <span class="comment">// Density is a std::optional&lt;std::reference_wrappper&lt;const Density&amp;&gt;&gt;</span></div>
<div class="line">    <span class="keywordflow">if</span> (mDensity)</div>
<div class="line">        multiplier = mDensity-&gt;value;</div>
<div class="line">    position.x += velocity.x * multiplier;</div>
<div class="line">    position.y += velocity.y * multiplier;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="structecstasy_1_1_not.html">ecstasy::Not</a></p>
<p class="startli">This one is kinda explicit. We will use a reverse example of the previous <code>Dynamic</code> marker component:</p>
<dl class="section warning"><dt>Warning</dt><dd>Don't use in <code>Select</code> clause because it doesn't make sense to select non existing data.</dd></dl>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.select&lt;Position, const Velocity&gt;().where&lt;Not&lt;const Static&gt;&gt;()) {</div>
<div class="line">    position.x += velocity.x;</div>
<div class="line">    position.y += velocity.y;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="structecstasy_1_1_or.html">Or</a> / <a class="el" href="structecstasy_1_1_xor.html">Xor</a></p>
<p class="startli">Performs a <code>Or</code>/<code>XOr</code> between the given components. Returned values are of type <a class="elRef" href="http://en.cppreference.com/w/cpp/utility/tuple.html">std::tuple</a>&lt;std::optional&lt;Q1&gt;, std::optional&lt;Q2&gt;...&gt;. It works for at least two components but can take more than 2. I really don't know real use case of this but well that was fun to code. For an easier access on the tuple you could leave the Or in the where clause and add Maybe selects in the Select:</p>
<div class="fragment"><div class="line"><span class="comment">// Assuming positions is a std::vector&lt;Position&gt;</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, positions, velocity] : registry.select&lt;Maybe&lt;Position&gt;, Maybe&lt;Positions&gt;, const Velocity&gt;().where&lt;Or&lt;Position, Positions&gt;&gt;()) {</div>
<div class="line">    <span class="keywordflow">if</span> (position) {</div>
<div class="line">        position.x += velocity.x;</div>
<div class="line">        position.y += velocity.y;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> pos in positions.value()) {</div>
<div class="line">            pos.x += velocity.x;</div>
<div class="line">            pos.y += velocity.y;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="structecstasy_1_1_and.html">ecstasy::And</a></p>
<p class="startli">Same as Or but performs an And. Meaning the returned values are not optional. It looks useless alone because it is the default behavior. But If you are creative you can do something fun with nested modifier... or just ignore that functionnality until you need it (if this times comes)</p>
<div class="fragment"><div class="line"><span class="comment">// Assuming working with 2D or 3D (yes this is dumb you should do 2 systems)</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [position2, position3, velocity2, velocity3] : registry</div>
<div class="line">    .select&lt;Maybe&lt;Position2D&gt;, Maybe&lt;Position3D&gt;, Maybe&lt;const Velocity2D&gt;, Maybe&lt;const Velocity3&gt;&gt;()</div>
<div class="line">    .where&lt;Or&lt;And&lt;Position2D, const Velocity2D&gt;, And&lt;Position3D, const Velocity3D&gt;&gt;&gt;()) {</div>
<div class="line">    <span class="keywordflow">if</span> (position2) {</div>
<div class="line">        position2.x += velocity2.x;</div>
<div class="line">        position2.y += velocity2.y;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        position3.x += velocity3.x;</div>
<div class="line">        position3.y += velocity3.y;</div>
<div class="line">        position3.z += velocity3.z;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="ConditionsTutorial"></a>
Using conditions</h2>
<p>In addition to the different modifiers, you can add runtime conditions to your query. Basic comparisons are implemented but you can add custom ones.</p>
<p>Conditions supports comparisons with:</p>
<ul>
<li>Constant values: <code>0</code></li>
<li>Class member: <code>&amp;Life::value</code></li>
<li>Class getter: <code>&amp;Life::getValue</code></li>
</ul>
<ol type="1">
<li><p class="startli"><a class="el" href="namespaceecstasy.html#a3636e577cd1e59a7d31089601561cc39">ecstasy::EqualTo</a></p>
<p class="startli">Ensure the two operands are equal for each matching entities.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.select&lt;const Life&gt;().where&lt;<a class="code hl_namespace" href="namespaceecstasy.html">ecstasy</a>::EqualTo&lt;&amp;Life::value, 0&gt;&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value == 0)) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="namespaceecstasy.html#a632aba6a51f51ed40b7bdc35331c6821">ecstasy::NotEqualTo</a></p>
<p class="startli">Ensure the two operands are not equal for each matching entities.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.select&lt;const Life&gt;().where&lt;<a class="code hl_namespace" href="namespaceecstasy.html">ecstasy</a>::NotEqualTo&lt;&amp;Life::value, 0&gt;&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value != 0)) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="namespaceecstasy.html#a8a47386bd7276dc4040566079eb1ec04">ecstasy::Less</a></p>
<p class="startli">Ensure the first operand is strictly lower than the second operand.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.select&lt;const Life&gt;().where&lt;Shield, <a class="code hl_namespace" href="namespaceecstasy.html">ecstasy</a>::Less&lt;&amp;Life::value, &amp;Shield::getValue&gt;&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value &lt; shield.getValue())) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="namespaceecstasy.html#ac8221c0f73ca2e3e2d5d7e92c5241317">ecstasy::LessEqual</a></p>
<p class="startli">Ensure the first operand is lower than or equal to the second operand.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.select&lt;const Life&gt;().where&lt;Shield, <a class="code hl_namespace" href="namespaceecstasy.html">ecstasy</a>::LessEqual&lt;&amp;Life::value, &amp;Shield::getValue&gt;&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value &lt;= shield.getValue())) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="namespaceecstasy.html#a261413d053df4c424df13459db564c8b">ecstasy::Greater</a></p>
<p class="startli">Ensure the first operand is strictly greater than the second operand.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.select&lt;const Life&gt;().where&lt;Shield, <a class="code hl_namespace" href="namespaceecstasy.html">ecstasy</a>::Greater&lt;&amp;Life::value, &amp;Shield::getValue&gt;&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value &gt; shield.getValue())) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="namespaceecstasy.html#accbc147ca8de440fdbe11ea1f67148af">ecstasy::GreaterEqual</a></p>
<p class="startli">Ensure the first operand is greater than or equal to the second operand.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> [life] : registry.select&lt;const Life&gt;().where&lt;Shield, <a class="code hl_namespace" href="namespaceecstasy.html">ecstasy</a>::GreaterEqual&lt;&amp;Life::value, &amp;Shield::getValue&gt;&gt;()) {</div>
<div class="line">    <span class="comment">// Condition equals: if (!(life.value &gt;= shield.getValue())) continue;</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="using-systems"></a>
Using systems</h1>
<p>To create systems, you only have to create a new class inheriting the <a class="el" href="classecstasy_1_1_i_system.html">ISystem</a> class and implement the <a class="el" href="classecstasy_1_1_i_system.html#aa9cf50e42a827f26e5d7e2c5d7fe9c46">run()</a> method.</p>
<p>For example here is how you would create a Movement system:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Movement : <span class="keyword">public</span> <a class="code hl_class" href="classecstasy_1_1_i_system.html">ecstasy::ISystem</a> {</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classecstasy_1_1_i_system.html#aa9cf50e42a827f26e5d7e2c5d7fe9c46">run</a>(<a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> &amp;registry) <span class="keyword">override</span> <span class="keyword">final</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> [position, velocity] : registry.query&lt;Position, const Velocity&gt;()) {</div>
<div class="line">            position.x += velocity.x;</div>
<div class="line">            position.y += velocity.y;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add it to the registry</span></div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"> </div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;Movement&gt;();</div>
<div class="line"> </div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a59904982ed7490f12c63628951178dd5">runSystem</a>&lt;Movement&gt;();</div>
<div class="line"><span class="comment">// or</span></div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>();</div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a59904982ed7490f12c63628951178dd5"><div class="ttname"><a href="classecstasy_1_1_registry.html#a59904982ed7490f12c63628951178dd5">ecstasy::Registry::runSystem</a></div><div class="ttdeci">void runSystem()</div><div class="ttdoc">Run a specific system from the registry.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l01168">Registry.hpp:1168</a></div></div>
</div><!-- fragment --><p>By default systems added with <code>Registry.addSystem()</code> have the same priority and the order of execution is undefined when calling <code>Registry.runSystems()</code>. But you can use the system priorities/groups to order them and be able to specify their priority and run a given system group.</p>
<ol type="1">
<li><p class="startli">Priority</p>
<p class="startli">When adding a system to the registry you can add a priority to each system as a second template parameter. Calling <code>runSystems()</code> will run the systems in ascending priority order.</p>
<dl class="section warning"><dt>Warning</dt><dd>You can set the same priority for multiple systems but it doesn't ensure they will always run in the same order.</dd></dl>
<div class="fragment"><div class="line"><a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"> </div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;A, 1&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;B, 2&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;C, 3&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;D, 4&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;E, 5&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;F, 6&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>(); <span class="comment">// ABCDEF</span></div>
<div class="line"><span class="comment">// If you want you can still call systems one by one</span></div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a59904982ed7490f12c63628951178dd5">runSystem</a>&lt;A&gt;(); <span class="comment">// A</span></div>
</div><!-- fragment --></li>
<li><p class="startli">Group and masks</p>
<p class="startli">In fact their is nothing more than the priority value. But using bitmask you can create groups.</p>
<p class="startli">The following example use 8 bits for the group id and 8 for the system priority.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line"><span class="comment">// Mask of the group part on the priority (bits 8-&gt;15)</span></div>
<div class="line"><span class="keywordtype">size_t</span> mask = 0xff00;</div>
<div class="line"><span class="comment">// Groups &#39;identifiers&#39;</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> abc = 0x0100;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> def = 0x0200;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Group &#39;abc&#39;</span></div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;A, abc + 1&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;B, abc + 2&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;C, abc + 3&gt;();</div>
<div class="line"><span class="comment">// Group &#39;def&#39;</span></div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;D, def + 1&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;E, def + 2&gt;();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a9ae0f363babc862fecb95e860730f5b7">addSystem</a>&lt;F, def + 3&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The following still calls the systems in the right order because their priorities are still ascending</span></div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>(); <span class="comment">// ABCDEF</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// You can run a system group by sending the group id and the mask</span></div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>(abc, mask); <span class="comment">// ABC</span></div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a5595f1c0811c0d7f658c01f49da8dc37">runSystems</a>(def, mask); <span class="comment">// DEF</span></div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="using-resources"></a>
Using resources</h1>
<p>Creating a resource is even simpler than creating a system: you only have to inherit <a class="el" href="classecstasy_1_1_i_resource.html">IResource</a>. And in case you cannot modify the inheritance tree of your object, you can just declare a using with <a class="el" href="classecstasy_1_1_object_wrapper.html">ObjectWrapper</a> (like <a class="el" href="namespaceecstasy_1_1integration_1_1user__action.html#a9b4f873eff13ede42a8a53839aea12b0">PendingActions</a> ).</p>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="classecstasy_1_1_registry.html#a6a5ab5ddcdc07e2e94c94cbb31a5c2e3">getResource()</a> will return a <a class="el" href="namespaceecstasy.html#a935f8c5172bfb738d9af3f1585f41cad">ResourceReference</a> (optional thread safe proxy) and you will therefore need to use the <code>get()</code> method.</dd></dl>
<p>For example here is how you would create and use an absolutely must have Counter system:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_i_resource_8hpp.html">ecstasy/resources/IResource.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Counter : <span class="keyword">public</span> <a class="code hl_class" href="classecstasy_1_1_i_resource.html">ecstasy::IResource</a> {</div>
<div class="line">    <span class="keywordtype">int</span> value;</div>
<div class="line"> </div>
<div class="line">    Counter(<span class="keywordtype">int</span> initial = 0)</div>
<div class="line">    {</div>
<div class="line">        this-&gt;value = initial;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> count()</div>
<div class="line">    {</div>
<div class="line">        ++this-&gt;value;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add it to the registry</span></div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_registry.html">ecstasy::Registry</a> registry;</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a79cab84435e7b20e9c41aae9cc543cfa">addResource</a>&lt;Counter&gt;(5);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get and use</span></div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a516a8ea8065455d601a30e1d3afbef52">getResource</a>&lt;Counter&gt;().get().count();</div>
<div class="line">registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a516a8ea8065455d601a30e1d3afbef52">getResource</a>&lt;Counter&gt;().get().value;</div>
<div class="ttc" id="a_i_resource_8hpp_html"><div class="ttname"><a href="_i_resource_8hpp.html">IResource.hpp</a></div><div class="ttdoc">Base class of all registry resources.</div></div>
<div class="ttc" id="aclassecstasy_1_1_i_resource_html"><div class="ttname"><a href="classecstasy_1_1_i_resource.html">ecstasy::IResource</a></div><div class="ttdoc">Base class of all registry resources.</div><div class="ttdef"><b>Definition</b> <a href="_i_resource_8hpp_source.html#l00029">IResource.hpp:33</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a516a8ea8065455d601a30e1d3afbef52"><div class="ttname"><a href="classecstasy_1_1_registry.html#a516a8ea8065455d601a30e1d3afbef52">ecstasy::Registry::getResource</a></div><div class="ttdeci">ResourceReference&lt; const R, Locked &gt; getResource() const</div><div class="ttdoc">Get the Resource of type R.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00906">Registry.hpp:906</a></div></div>
<div class="ttc" id="aclassecstasy_1_1_registry_html_a79cab84435e7b20e9c41aae9cc543cfa"><div class="ttname"><a href="classecstasy_1_1_registry.html#a79cab84435e7b20e9c41aae9cc543cfa">ecstasy::Registry::addResource</a></div><div class="ttdeci">R &amp; addResource(Args &amp;&amp;...args)</div><div class="ttdoc">Add a new resource in the registry.</div><div class="ttdef"><b>Definition</b> <a href="_registry_8hpp_source.html#l00853">Registry.hpp:853</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="EnsuringThreadSafety"></a>
Ensuring Thread Safety</h1>
<p>By default ecstasy is not thread safe. By not thread safe I mean there is absolutely nothing enabled to prevent your threads to do whatever they want at the same time.</p>
<p>But no worries it is just some compilation options to set:</p>
<ul>
<li><b>ECSTASY_LOCKABLE_RESOURCES</b> will make <a class="el" href="classecstasy_1_1_i_resource.html">IResource</a> class validate the <a class="el" href="conceptecstasy_1_1thread_1_1_lockable.html">Lockable</a> concept.</li>
<li><b>ECSTASY_LOCKABLE_STORAGES</b> will make <a class="el" href="classecstasy_1_1_i_storage.html">IStorage</a> class validate the <a class="el" href="conceptecstasy_1_1thread_1_1_lockable.html">Lockable</a> concept.</li>
<li><b>ECSTASY_AUTO_LOCK</b> will lock any <a class="el" href="conceptecstasy_1_1thread_1_1_lockable.html">Lockable</a> queryables in any registry queries or registry modifiers.</li>
<li><b>ECSTASY_THREAD_SAFE</b> will enable the three options above.</li>
</ul>
<p>This being done every lockables will be locked (if <b>ECSTASY_AUTO_LOCK</b> is set) when performing queries from the registry:</p>
<ul>
<li>If they are queried const qualified they will be shared lock, meaning multiple threads can access the queryables at the same time in a read only way.</li>
<li>However if they are not const qualified the lock will be exclusive, waiting any thread reading (or writing) the queryable and then blocking any other thread to access it until unlocked.</li>
</ul>
<p>This allows a generic thread safety while reducing thread contention as much as possible.</p>
<p>If you want to handle thread safety yourself you still have multiple options:</p>
<ol type="1">
<li><p class="startli">Get it your own way</p>
<p class="startli">Just disable the above options and do what you want, but outside the queries because of encapsulation you will not have the same generic access.</p>
</li>
<li><p class="startli">Lock explicitly</p>
<p class="startli">Keep the resources/storages as lockable and use the <a class="el" href="classecstasy_1_1_registry.html#ad2dcff29b1572f42791329d7c18ec35b">queryEx</a> "Registry::queryEx" (and Select.whereEx) methods or <a class="el" href="structecstasy_1_1_and_ex.html">AndEx</a>, <a class="el" href="structecstasy_1_1_or_ex.html">OrEx</a> modifiers where you can explicitly specify the AutoLock value.</p>
</li>
<li><p class="startli">AutoLock by default but disable when you know what you're doing</p>
<p class="startli">I know sometimes ecstasy can lock multiple times the same mutex because it is hard to detect. But if you know it and it is sensitive systems (running lot of times per frame) you can use the *Ex methods to UnLock explicitly the same way.</p>
</li>
</ol>
<h1><a class="anchor" id="using-cross-platform-rtti"></a>
Using cross platform RTTI</h1>
<h2><a class="anchor" id="why-use-custom-rtti-implementation"></a>
Why use custom RTTI implementation</h2>
<p>C++ already has its own RTTI integration with <a class="elRef" href="http://en.cppreference.com/w/cpp/types/type_info.html">std::type_info</a> (as returned by typeid). With this you can get a unique hash for each type using <a class="elRef" href="http://en.cppreference.com/w/cpp/types/type_info/hash_code.html">std::type_info::hash_code()</a>. However, this hash is not cross platform since it is implementation specific. And most important, it is not guaranteed to stay the same between 2 runs.</p>
<p>As explained in the <a class="elRef" href="http://en.cppreference.com/w/cpp/types/type_info/hash_code.html">std::type_info::hash_code()</a> documentation: </p><pre class="fragment">Returns an unspecified value (here denoted by hash code) such that for all std::type_info objects referring to the same type,
their hash code is the same.

No other guarantees are given: std::type_info objects referring to different types may have the same hash code
(although the standard recommends that implementations avoid this as much as possible),
and hash code for the same type can change between invocations of the same program.
</pre><p> It also returns a <a class="elRef" href="http://en.cppreference.com/w/cpp/types/type_info/name.html">std::type_info::name()</a> function, but its results are mangled in g++ (maybe clang too) but not in MSVC.</p>
<p>For all these reasons, it make cross-platform serialization of custom types impossible using only <a class="elRef" href="http://en.cppreference.com/w/cpp/types/type_info.html">std::type_info</a>.</p>
<h2><a class="anchor" id="how-to-use-it"></a>
How to use it</h2>
<h3><a class="anchor" id="how-is-it-stored"></a>
How is it stored</h3>
<p>This custom rtti use mainly two classes: <a class="el" href="classecstasy_1_1rtti_1_1_type_registry.html">TypeRegistry</a> and <a class="el" href="classecstasy_1_1rtti_1_1_a_type.html">AType</a>.</p>
<p>The TypeRegistry is a singleton storing all AType instances.</p>
<p>The <a class="el" href="classecstasy_1_1rtti_1_1_a_type.html">AType</a> is the replacement of <a class="elRef" href="http://en.cppreference.com/w/cpp/types/type_info.html">std::type_info</a>. It is mainly a wrapper over the <a class="elRef" href="http://en.cppreference.com/w/cpp/types/type_info.html">std::type_info</a> with a user defined name (which is supposed to be the same for every program run) and therefore a cross platform hash which is the hash of the name.</p>
<p>And it also contains the <a class="el" href="classecstasy_1_1serialization_1_1_i_entity_component_serializer.html">IEntityComponentSerializer</a> instances for the serialization part (see Serializing your entities section)</p>
<h3><a class="anchor" id="registering-types"></a>
Registering types</h3>
<p>First of all you need to register the types for which you want cross-platform RTTI using the macro <a class="el" href="_type_registry_8hpp.html#ad7044dbc834b00bd27108e9a8df4dcd8">REGISTER_TYPES</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// The macro is defined in this included</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_type_registry_8hpp.html">ecstasy/rtti/TypeRegistry.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Position {</div>
<div class="line">    <span class="keywordtype">float</span> x;</div>
<div class="line">    <span class="keywordtype">float</span> y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Size {</div>
<div class="line">    <span class="keywordtype">float</span> width;</div>
<div class="line">    <span class="keywordtype">float</span> height;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// You can register as much types as you want (variadic macro)</span></div>
<div class="line"><a class="code hl_define" href="_type_registry_8hpp.html#ad7044dbc834b00bd27108e9a8df4dcd8">REGISTER_TYPES</a>(Position, Size);</div>
<div class="ttc" id="a_type_registry_8hpp_html"><div class="ttname"><a href="_type_registry_8hpp.html">TypeRegistry.hpp</a></div></div>
<div class="ttc" id="a_type_registry_8hpp_html_ad7044dbc834b00bd27108e9a8df4dcd8"><div class="ttname"><a href="_type_registry_8hpp.html#ad7044dbc834b00bd27108e9a8df4dcd8">REGISTER_TYPES</a></div><div class="ttdeci">#define REGISTER_TYPES(TYPE,...)</div><div class="ttdoc">Register multiple component types.</div><div class="ttdef"><b>Definition</b> <a href="_type_registry_8hpp_source.html#l00041">TypeRegistry.hpp:41</a></div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>I tried to do automatic type registration (ie not requiring to use a macro), but for all the above reasons, I couldn't find a way to do it.</dd>
<dd>
The macro <a class="el" href="ecstasy_2serialization_2_serializer_8hpp.html#a0ca77627672ee4d0c582e482138445c6">REGISTER_SERIALIZABLES</a> will also register the type.</dd></dl>
<p>You can also do it without the macro like this:</p>
<div class="fragment"><div class="line"><span class="comment">// The macro is defined in this included</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_type_registry_8hpp.html">ecstasy/rtti/TypeRegistry.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Position {</div>
<div class="line">    <span class="keywordtype">float</span> x;</div>
<div class="line">    <span class="keywordtype">float</span> y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This returns a reference to the new @ref AType created.</span></div>
<div class="line"><a class="code hl_function" href="classecstasy_1_1rtti_1_1_type_registry.html#a07f65105bd02f2d10883effc1916b460">ecstasy::rtti::TypeRegistry::getInstance</a>().<a class="code hl_function" href="classecstasy_1_1rtti_1_1_type_registry.html#aea9f3c3694443622a964231690a886f2">registerType</a>&lt;Position&gt;(<span class="stringliteral">&quot;Position&quot;</span>);</div>
<div class="ttc" id="aclassecstasy_1_1rtti_1_1_type_registry_html_a07f65105bd02f2d10883effc1916b460"><div class="ttname"><a href="classecstasy_1_1rtti_1_1_type_registry.html#a07f65105bd02f2d10883effc1916b460">ecstasy::rtti::TypeRegistry::getInstance</a></div><div class="ttdeci">static TypeRegistry &amp; getInstance() noexcept</div><div class="ttdoc">Get the Instance object.</div><div class="ttdef"><b>Definition</b> <a href="_type_registry_8cpp_source.html#l00017">TypeRegistry.cpp:17</a></div></div>
<div class="ttc" id="aclassecstasy_1_1rtti_1_1_type_registry_html_aea9f3c3694443622a964231690a886f2"><div class="ttname"><a href="classecstasy_1_1rtti_1_1_type_registry.html#aea9f3c3694443622a964231690a886f2">ecstasy::rtti::TypeRegistry::registerType</a></div><div class="ttdeci">AType &amp; registerType(std::string_view name)</div><div class="ttdoc">Register a type in the registry.</div><div class="ttdef"><b>Definition</b> <a href="_type_registry_8hpp_source.html#l00084">TypeRegistry.hpp:84</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="querying-types"></a>
Querying types</h3>
<p>The type registry can be queried from multiple data types:</p>
<ul>
<li>Using no data type but the type has a template parameter: <code>registry.has&lt;Position&gt;()</code></li>
<li>Using the name hash as returned by <a class="el" href="classecstasy_1_1rtti_1_1_a_type.html#a0b1a60bfc99960065bd9198d95c32616">ecstasy::rtti::AType::getHash()</a></li>
<li>Using a const <a class="elRef" href="http://en.cppreference.com/w/cpp/types/type_info.html">std::type_info</a></li>
<li>Using another <a class="el" href="classecstasy_1_1rtti_1_1_a_type.html">ecstasy::rtti::AType</a></li>
<li>Using the cross platform name</li>
<li>Using a predicate (only for get/find methods)</li>
</ul>
<h1><a class="anchor" id="serializing-your-entities"></a>
Serializing your entities</h1>
<p>Ecstasy has some built in serialization helpers in the <a class="el" href="namespaceecstasy_1_1serialization.html">ecstasy::serialization</a> namespace.</p>
<p>The current available serializers are the following:</p>
<ul>
<li>RawSerializer: Custom binary serialization of components fields. Compact form but not related to any RFC.</li>
<li>JsonSerializer: Classic json serialization of components. Not compact but readable.</li>
</ul>
<p>If you need a missing serializer, you can write it yourself by inheriting the <a class="el" href="classecstasy_1_1serialization_1_1_serializer.html">Serializer</a> class. In case of a commonly used serializer type (json/yaml/NDR...) feel free to open an issue about it.</p>
<dl class="section warning"><dt>Warning</dt><dd>The RawSerializer uses a <a class="elRef" href="http://en.cppreference.com/w/cpp/io/basic_stringstream.html">std::stringstream</a>. Therefore there are cursor positions, if you need to read twice the data, you need to reset the read cursor position.</dd></dl>
<h2><a class="anchor" id="using-a-serializer"></a>
Using a serializer</h2>
<p>Following examples below will be using the RawSerializer type and the example component Position:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Position {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">float</span> x;</div>
<div class="line">    <span class="keywordtype">float</span> y;</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="common-types"></a>
Common types</h3>
<p>Serializer should support fundamental and container types by default but it depends on the serializer implementation.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Serializer   </th><th class="markdownTableHeadNone">Fundamental (integers, floats, doubles...)   </th><th class="markdownTableHeadNone">strings   </th><th class="markdownTableHeadNone">containers    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="classecstasy_1_1serialization_1_1_raw_serializer.html">RawSerializer</a>   </td><td class="markdownTableBodyNone">Ok   </td><td class="markdownTableBodyNone">OK   </td><td class="markdownTableBodyNone">Ok    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="classecstasy_1_1serialization_1_1_json_serializer.html">JsonSerializer</a>   </td><td class="markdownTableBodyNone">Ok   </td><td class="markdownTableBodyNone">OK   </td><td class="markdownTableBodyNone">Ok   </td></tr>
</table>
<p><b>1. Saving</b></p>
<p>To save an object in a serializer, you can either call the method <b>save</b> or use the insertion operator **&lt;&lt;**</p>
<div class="fragment"><div class="line">RawSerializer serializer();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Either with method save</span></div>
<div class="line">serializer.save(42);</div>
<div class="line"><span class="comment">// Or with insertion operator</span></div>
<div class="line">serializer &lt;&lt; 42;</div>
</div><!-- fragment --><p><b>2. Exporting/Importing</b></p>
<p>You can export your serialized data using the <em>export*</em> methods. And import them back with <em>import*</em> methods.</p>
<div class="fragment"><div class="line">RawSerializer serializer();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Save all your variables...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Export to a string</span></div>
<div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> serialized = serializer.exportBytes();</div>
<div class="line"><span class="comment">// Or to a file</span></div>
<div class="line">serializer.exportFile(<span class="stringliteral">&quot;mydata.bin&quot;</span>);</div>
<div class="line"><span class="comment">// Or to a stream</span></div>
<div class="line">serializer.exportStream(<a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a>);</div>
<div class="line"> </div>
<div class="line">RawSerializer importSerializer(serialized);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Or import from bytes on existing serializer</span></div>
<div class="line">importSerializer.importBytes(serialized);</div>
<div class="line"><span class="comment">// Or from a file</span></div>
<div class="line">importSerializer.importFile(<span class="stringliteral">&quot;mydata.bin&quot;</span>);</div>
<div class="line"><span class="comment">// Or from a stream</span></div>
<div class="line">importSerializer.importStream(<a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/cin.html">std::cin</a>);</div>
<div class="ttc" id="abasic_string_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a></div></div>
<div class="ttc" id="acin_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/cin.html">std::cin</a></div></div>
<div class="ttc" id="acout_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/cout.html">std::cout</a></div></div>
</div><!-- fragment --><p><b>3. Updating</b></p>
<p>To update an object from a serializer, you can either call the method <b>update</b> or use the extraction operator **&gt;&gt;**</p>
<div class="fragment"><div class="line">RawSerializer serializer(<a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/filesystem/path.html">std::filesystem::path</a>(<span class="stringliteral">&quot;mydata.bin&quot;</span>));</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> my_number = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Either with method update</span></div>
<div class="line">serializer.update(my_number);</div>
<div class="line"><span class="comment">// Or with extraction operator</span></div>
<div class="line">serializer &gt;&gt; my_number;</div>
<div class="ttc" id="apath_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/filesystem/path.html">std::filesystem::path</a></div></div>
</div><!-- fragment --><p><b>4. Loading</b></p>
<p>To load an object from a serializer, you need to call the load template method.</p>
<dl class="section note"><dt>Note</dt><dd>If there is no load method implemented for the type but the type is default constructible, it will be default constructed then updated.</dd></dl>
<div class="fragment"><div class="line">RawSerializer serializer(<a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/filesystem/path.html">std::filesystem::path</a>(<span class="stringliteral">&quot;mydata.bin&quot;</span>));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Fill your serializer with previously saved data using import methods</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> my_number = serializer.load&lt;<span class="keywordtype">int</span>&gt;();</div>
</div><!-- fragment --><h3><a class="anchor" id="custom-types"></a>
Custom types</h3>
<p>If you are working with custom type (ie components) you can implement the extraction (**&gt;&gt;**) and insertion operator (**&lt;&lt;**) with the said serializer type for the <em>save</em>/_update_. And a constructor taking the serializer as parameter for the <em>load</em>.</p>
<dl class="section note"><dt>Note</dt><dd>The operators doesn't have to be inside the class, you can define it outside the class if you don't have access to the class definition. However it cannot work for the constructor.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">// Custom constructor for load method</span></div>
<div class="line">Position(RawSerializer &amp;serializer) : x(serializer.load&lt;float&gt;()), y(serializer.load&lt;float&gt;())</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Extraction operator for save</span></div>
<div class="line">RawSerializer &amp;operator&gt;&gt;(RawSerializer &amp;serializer)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keywordflow">return</span> serializer &lt;&lt; x &lt;&lt; y</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Insertion operator for update</span></div>
<div class="line">Position &amp;<a class="code hl_functionRef" href="https://marzer.github.io/tomlplusplus/namespacetoml.html#aba6195d5e83ab18f30c9a211384e2c1a">operator&lt;&lt;</a>(RawSerializer &amp;serializer)</div>
<div class="line">{</div>
<div class="line">    serializer &gt;&gt; x &gt;&gt; y;</div>
<div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line">}</div>
<div class="ttc" id="anamespacetoml_html_aba6195d5e83ab18f30c9a211384e2c1a"><div class="ttname"><a href="https://marzer.github.io/tomlplusplus/namespacetoml.html#aba6195d5e83ab18f30c9a211384e2c1a">toml::operator&lt;&lt;</a></div><div class="ttdeci">std::basic_ostream&lt; Char &gt; &amp; operator&lt;&lt;(std::basic_ostream&lt; Char &gt; &amp;lhs, node_type rhs)</div></div>
</div><!-- fragment --><p>If you need to (de)serialize the type from the save/update/loadEntity methods, you first need to register the type as serializable by the expected Serializer using the variadic macro <a class="el" href="ecstasy_2serialization_2_serializer_8hpp.html#a0ca77627672ee4d0c582e482138445c6">REGISTER_SERIALIZABLES</a></p>
<p>For example, if you want you type Position to be serializable by the RawSerializer and the (maybe to come) JsonSerializer:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="ecstasy_2serialization_2_serializer_8hpp.html#a0ca77627672ee4d0c582e482138445c6">REGISTER_SERIALIZABLES</a>(Position, RawSerializer, JsonSerializer)</div>
<div class="ttc" id="aecstasy_2serialization_2_serializer_8hpp_html_a0ca77627672ee4d0c582e482138445c6"><div class="ttname"><a href="ecstasy_2serialization_2_serializer_8hpp.html#a0ca77627672ee4d0c582e482138445c6">REGISTER_SERIALIZABLES</a></div><div class="ttdeci">#define REGISTER_SERIALIZABLES(COMPONENT, a1,...)</div><div class="ttdoc">Register a component to multiple serializers.</div><div class="ttdef"><b>Definition</b> <a href="ecstasy_2serialization_2_serializer_8hpp_source.html#l00054">Serializer.hpp:54</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="working-with-entities"></a>
Working with Entities</h3>
<p>Since you can serialize any type, you can serialize entity components manually using the functions above.</p>
<p>You can save entity components explicitly using the templated saveEntity method, or every registered components with the classic saveEntity method.</p>
<dl class="section warning"><dt>Warning</dt><dd>To use the non templated <code>saveEntity</code> method, you need to register them using the <a class="el" href="ecstasy_2serialization_2_serializer_8hpp.html#a0ca77627672ee4d0c582e482138445c6">REGISTER_SERIALIZABLES</a> macro (see below).</dd></dl>
<div class="fragment"><div class="line">RawSerializer serializer();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_registry_entity.html">ecstasy::RegistryEntity</a> entity(</div>
<div class="line">        registry.<a class="code hl_function" href="classecstasy_1_1_registry.html#a4418ff08eb494b1babb2ee715035d20a">entityBuilder</a>().<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#ae55a0fc396c88eeedb1795b3fd6cb0f7">with</a>&lt;Position&gt;(1.0f, -8456.0f).<a class="code hl_function" href="classecstasy_1_1_registry_1_1_entity_builder.html#ae55a0fc396c88eeedb1795b3fd6cb0f7">with</a>&lt;NPC&gt;(Position(42.f, 0.f), <span class="stringliteral">&quot;Steve&quot;</span>).build(),</div>
<div class="line">        registry);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Save an entity explicit components</span></div>
<div class="line">rawSerializer.saveEntity&lt;NPC, Position&gt;(entity);</div>
<div class="line"><span class="comment">// Or save the whole entity</span></div>
<div class="line">rawSerializer.saveEntity(entity);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Update an existing entity</span></div>
<div class="line">rawSerializer.updateEntity(entity);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Or create it entirely</span></div>
<div class="line"><a class="code hl_class" href="classecstasy_1_1_registry_entity.html">ecstasy::RegistryEntity</a> newEntity = rawSerializer.loadEntity(registry);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
